<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4519"/>

<div>
<span><div style="font-size: 14px; text-size-adjust: 100%; background: rgb(255, 255, 255);"><div style="font-size: 14px; background-color: rgb(255, 255, 255);"><div style="box-sizing:border-box;"><div style="flex-wrap:wrap;list-style:none;"><div style="flex:0 0 auto;box-sizing:border-box;"><h3 style="margin: 0px 0px 15px; text-transform: none; font-size: 18px;"><span style="font-size: 16px; min-width: 100%; position: relative;"><span style="font-size: 18px; color: rgb(68, 68, 68); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 24px;">使用Fabric部署网站应用</span></span></h3><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><a href="https://www.liaoxuefeng.com/user/001383729881018b677b2776c24451e9b5f30a03ea5d73c000" style="background: transparent; cursor: pointer; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; line-height: 20px; color: rgb(5, 147, 211); text-decoration-line: none;">廖雪峰</a> <span style="color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; line-height: 20px;">/</span> <a href="https://www.liaoxuefeng.com/category/0013738748415562fee26e070fa4664ad926c8e30146c67000" style="background: transparent; cursor: pointer; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; line-height: 20px; color: rgb(5, 147, 211); text-decoration-line: none;">编程</a> <span style="color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; line-height: 20px;">/ 2011-3-30 4:12 / 阅读: 1</span><br/></div><div style="margin: 0px 0px 15px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">以前一直用rsync同步代码到服务器，这种山寨方法用一次两次还可，每天部署10次就麻烦了，最近抽空研究了一下Fabric，发现这个东西部署起来简直太爽了。</span></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">Fabric是一个用Python开发的部署工具，最大特点是不用登录远程服务器，在本地运行远程命令，几行Python脚本就可以轻松部署。</span></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">花10分钟写了一个部署脚本fabfile.py（名字不能变），放到工程目录下：</span></div><div style="margin: 15px 0px; background: rgb(250, 250, 250); font-size: 12px; padding: 10px; tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap;"><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">#!/usr/bin/env python</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># -*- coding: utf-8 -*-</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">from</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">datetime</span> <span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">import</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">datetime</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">from</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">fabric.api</span> <span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">import</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">*</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 登录用户和主机名：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">env.user =</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'root'</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">env.hosts = [</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'www.example.com'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">]</span> <span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 如果有多个主机，fabric会自动依次部署</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">def</span> <span style="font-size: 12px; color: rgb(153, 0, 0); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">pack</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">():</span></div><div><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">' 定义一个pack任务 '</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 打一个tar包：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">tar_files = [</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'*.py'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">,</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'static/*'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">,</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'templates/*'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">,</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'favicon.ico'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">]</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">local(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'rm -f example.tar.gz'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">)</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">local(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'tar -czvf example.tar.gz --exclude=\'*.tar.gz\' --exclude=\'fabfile.py\' %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">%</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">' '</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">.join(tar_files))</span></div><div><br/></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">def</span> <span style="font-size: 12px; color: rgb(153, 0, 0); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">deploy</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">():</span></div><div><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">' 定义一个部署任务 '</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 远程服务器的临时文件：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">remote_tmp_tar =</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'/tmp/example.tar.gz'</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">tag = datetime.now().strftime(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'%y.%m.%d_%H.%M.%S'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">)</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'rm -f %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% remote_tmp_tar)</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 上传tar文件至远程服务器：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">put(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'shici.tar.gz'</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">, remote_tmp_tar)</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 解压：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">remote_dist_dir =</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'/srv/www.example.com@%s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% tag</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">remote_dist_link =</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'/srv/www.example.com'</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'mkdir %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% remote_dist_dir)</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">with</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">cd(remote_dist_dir):</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'tar -xzvf %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% remote_tmp_tar)</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 设定新目录的www-data权限:</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'chown -R www-data:www-data %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% remote_dist_dir)</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 删除旧的软链接：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'rm -f %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% remote_dist_link)</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 创建新的软链接指向新部署的目录：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'ln -s %s %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% (remote_dist_dir, remote_dist_link))</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'chown -R www-data:www-data %s'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% remote_dist_link)</span></div><div><span style="font-size: 12px; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;"># 重启fastcgi：</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">fcgi =</span> <span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'/etc/init.d/py-fastcgi'</span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">with</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">settings(warn_only=</span><span style="font-size: 12px; color: rgb(0, 134, 179); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">True</span><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">):</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'%s stop'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% fcgi)</span></div><div><span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">run(</span><span style="font-size: 12px; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">'%s start'</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">% fcgi)</span></div></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">以上定义了pack和deploy两个任务，如果我们用Fabric部署，只需简单地输入两条命令：</span></div><div style="margin: 15px 0px; background: rgb(250, 250, 250); font-size: 12px; padding: 10px; tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap;"><div><span style="font-size: 12px; color: rgb(0, 128, 128); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">$</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">fab pack</span></div><div><span style="font-size: 12px; color: rgb(0, 128, 128); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">$</span> <span style="font-size: 12px; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 18px;">fab deploy</span></div></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">Fabric提供几个简单的API来完成所有的部署，最常用的是local()和run()，分别在本地和远程执行命令，put()可以把本地文件上传到远程，当需要在远程指定当前目录时，只需用with cd('/path/to/dir/'):即可。</span></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">默认情况下，当命令执行失败时，Fabric会停止执行后续命令。有时，我们允许忽略失败的命令继续执行，比如run('rm /tmp/abc')在文件不存在的时候有可能失败，这时可以用with settings(warn_only=True):执行命令，这样Fabric只会打出警告信息而不会中断执行。</span></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">Fabric是如何在远程执行命令的呢？其实Fabric所有操作都是基于SSH执行的，必要时它会提示输入口令，所以非常安全。更好的办法是在指定的部署服务器上用证书配置无密码的ssh连接。</span></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">如果是基于团队开发，可以让Fabric利用版本库自动检出代码，自动执行测试、打包、部署的任务。由于Fabric运行的命令都是基本的Linux命令，所以根本不需要用Fabric本身来扩展，会敲Linux命令就能用Fabric部署。</span></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap;"><span style="font-size: 14px; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 20px;">利用Fabric部署Python、Ruby、PHP这样的非编译型网站应用非常方便，而对于编译型的Java、C#等就麻烦了，编译本身就是一个极其复杂的大工程，需要依赖特定工具或者IDE，很难做到自动化。</span></div><h3 style="margin: 25px 0px 15px; text-transform: none; font-size: 18px;"><br/></h3></div></div></div></div></div><div><br/></div></span>
</div></body></html> 