<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3680"/>

<div>
<span><div style="-evernote-webclip:true;"><div><br/></div><div style="font-size: 100%; vertical-align: baseline; text-rendering: optimizeLegibility;"><div style="font-size: 12px; vertical-align: baseline; word-break: break-all; overflow-wrap: break-word; background: none 0% 0% repeat scroll rgb(238, 238, 238);"><div style="font-size: 100%; vertical-align: baseline; background: none 0% 0% repeat scroll rgb(255, 255, 255);"><div style="font-size: 100%; vertical-align: baseline;"><div style="font-size: 100%; vertical-align: baseline;"><div style="font-size: 100%; vertical-align: baseline;"><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline;"><h1 style="margin: 0px; text-rendering: optimizeLegibility; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 24px;"><span style="font-size: 16px;"><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; font-weight: 400; line-height: 1.2;">SDN系列4—VXLAN/NVGRE</span></span></h1><div style="margin: 0px; border-width: 0px 0px 1px; border-style: none none dotted; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; vertical-align: baseline; padding: 10px 0px; font-size: 14px; position: relative; border-bottom-color: rgb(204, 204, 204);"><span style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline; float: right;"><br/></span></div></div><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline;"><div style="margin: 0px; border: 0px none; font-size: 100%; vertical-align: baseline; padding: 20px 0px;"><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline;"><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline;"><span style="font-size: 100%; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;"><img height="16" style="height:auto;vertical-align:middle;border:0px none;max-width:98%;" width="0"></img></span></div><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline;"><h3 style="margin: 0px; text-rendering: optimizeLegibility; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 40px;">VLAN和GRE的不足</span></h3><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline; list-style: none outside none;"><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">VLAN使用12位标签标识不同的VLAN，最多只能支持4096个网络</span></div></div><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline; list-style: none outside none;"><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">VLAN基于L2，很难跨越L2的边界，限制了网络的灵活性</span></div></div><div style="margin: 0px; padding: 0px; border: 0px none; font-size: 100%; vertical-align: baseline; list-style: none outside none;"><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">GRE是点对点的，网络数量很大时需要很多通道，难以扩展和管理</span></div></div><h3 style="margin: 0px; text-rendering: optimizeLegibility; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 40px;">VXLAN</span></h3><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">VXLAN全称Virtual eXtensible LAN，把VLAN 12bit的tag扩展到了24bit。VXLAN是一种L2 over UDP，它利用了UDP同时利用了IPv4 的单播和多播，可以跨 L3 边界，很巧妙地解决了 GRE tunnel 和 VLAN 的不足。VXLAN的头部结构如下所示:</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;"><img height="24" style="height:auto;max-width:98%;vertical-align:middle;border:0px;" width="24"></img></span></div><h3 style="margin: 0px; text-rendering: optimizeLegibility; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 40px;">NVGRE</span></h3><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">微软提出的NVGRE标准也使用封装策略来创建大量的VLAN子网，这些子网可以扩展到分散的数据中心和2、3层网络。实现了在云和专有网络中共享负载均衡的多租赁网络。NVGRE使用GRE来创建一个独立的虚拟2层网络，限制物理2层网络或扩展超过子网边界，并通过租赁网络标识符TNI解决多租赁网络问题，每个TNI都与一个GRE通道相关联。从通道终端发送的数据包会通过IP组播送往与同一个TNI相关的另一个终端。使用多播技术意味着通道可以扩展到3层网络，将一个大型的广播域划分成多个较小的域，从而限制广播流量。</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;"><img src="SDN4-VXLANNVGRE_files/image9.png" type="image/png" data-filename="image9.png" height="235" style="height:auto;max-width:98%;vertical-align:middle;border:0px;" width="690"/></span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">可以看到，NVGRE和VXLAN高度相似，最大的不同在于报文的封装，VXLAN基于UDP封包，NVGRE则选择了GRE。</span></div><h3 style="margin: 0px; text-rendering: optimizeLegibility; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 40px;">STT</span></h3><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">SST(无状态传输协议)是另外一种技术，其主要支持厂商是Nicira。与VXLAN和NVGRE相比，STT有较大的不同。其在IP报头内使用了无状态TCP类报头，允许端系统的隧道端点利用驻留在服务器网卡上的TCP卸载引擎(TOE)的TCP分片卸载功能(TSO).</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;"><img height="24" style="height:auto;max-width:98%;vertical-align:middle;border:0px;" width="24"></img></span></div><h3 style="margin: 0px; text-rendering: optimizeLegibility; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 40px;">VXLAN使用</span></h3><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">1）OpenVswitch使用GRE的命令：</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ovs-vsctl add-port br0 tep0 -- set interface tep0 type=internal</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ifconfig tep0 192.168.1.11 netmask 255.255.255.0</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ovs-vsctl add-int br2 gre0 -- set interface gre1 type=gre options:remote_ip=192.168.1.11</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ovs-vsctl add-int br2 gre0 -- set interface gre1 type=gre options:remote_ip=192.168.1.10</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">2) linux bridge中的vxlan</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">brctl addbr br.4090</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ip link add vxlan4090 type vxlan id 4090 group 239.1.1.1 dev eth0</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ip link set vxlan4090 up</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ip link set br.4090 up</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">brctl addif br.4090 vxlan4090</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">然后将虚机的tap设备插入到上述网桥即可.</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 20px;">3） OpenVswitch中使用VXLAN的命令：</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ovs-vsctl add-int br2 vx1 -- set interface vx1 type=vxlan options:remote_ip=192.168.1.10</span></div><div style="padding: 5px 12px; font-size: 0.88em; margin: 0px; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); vertical-align: baseline; border-radius: 3px; word-wrap: break-word;"><span style="font-size: 0.88em; color: rgb(51, 51, 51); font-family: &quot;Microsoft YaHei&quot;, SimSun, &quot;Arial Narrow&quot;; line-height: 24px;">ovs-vsctl add-int br2 vx1 -- set interface vx1 type=vxlan options:remote_ip=192.168.1.11</span></div><div style="margin: 0px; padding: 0px; border: 0px none; vertical-align: baseline; font-size: 14px;"><br/></div></div></div></div></div><div><br/></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 