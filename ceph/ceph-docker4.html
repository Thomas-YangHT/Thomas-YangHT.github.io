<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2198"/>

<div>
<span><div><div>ceph</div><h1>安装前约定</h1><h2>主要目录</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/etc/ceph/                 主要为配置</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/var/lib/ceph/           主要为数据</span></div><h2>对应关系</h2><table border="1"><colgroup><col></col><col></col><col></col></colgroup><tbody><tr><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div></td><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">宿主机</span></div></td><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Docker容器</span></div></td></tr><tr><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/etc/ceph/</span></div></td><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/etc/ceph/</span></div></td><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/etc/ceph/</span></div></td></tr><tr><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/var/lib/ceph/</span></div></td><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/var/lib/ceph/</span></div></td><td valign="top" width="189"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">/var/lib/ceph/</span></div></td></tr></tbody></table><h2>机器列表</h2><table border="1"><colgroup><col></col><col></col><col></col><col></col></colgroup><tbody><tr><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">机器名</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">IP地址</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">role</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div></td></tr><tr><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">C 381</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">1.2.3.4</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Mon，osd</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div></td></tr><tr><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">C 382</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">1.2.3.5</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Mon，osd,mds</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div></td></tr><tr><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">C 383</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">1.2.3.6</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Mon，osd, rgw</span></div></td><td valign="top" width="142"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div></td></tr></tbody></table><div><br/></div><div><br/></div><div> <br/></div><h1>Ceph Mon多节点安装</h1><h2>说明</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Ceph的MON是一个集群映射图的“主副本”，客户端只需通过连接到MON就可以了解Ceph-MON、Ceph的OSD守护进程，和Ceph的元数据服务器的位置。</span></div><h2>安装首节点MON</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host  \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=mon \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e MON_IP=1.2.3.4 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e CEPH_PUBLIC_NETWORK=1.2.3.0/24 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Mon</span></div><h2>编辑/etc/ceph.conf配置文件</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">注意调整下表中红色部份的值。</span></div><table border="1"><colgroup><col></col></colgroup><tbody><tr><td valign="top" width="568"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">[global]</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">fsid = 695b3afb-f560-434f-a90a-f611e1f23638</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mon initial members = c381</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mon host = 1.2.3.4</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">auth cluster required = cephx</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">auth service required = cephx</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">auth client required = cephx</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><ul><li><div>osd pool default size = 2</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">public network = 1.2.3.0/24</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">cluster network = 1.2.3.0/24</span></div><ul><li><div>osd journal size = 100</div></li></ul><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">osd pool default pg num = 100</span></div><ul><li><div>osd pool default pgp num = 100</div></li></ul></td></tr></tbody></table><div style="margin-top: 1em; margin-bottom: 1em;"></div><h2>将相关ceph目录cp到各个节点</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">按需操作，一种思路：非root帐号先scp到目标机器/tmp下，再挪到指定位置。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">涉及目录：/etc/ceph/和/var/lib/ceph/</span></div><h2>安装第二及第三节点</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host  \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=mon \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e MON_IP=1.2.3.5 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e CEPH_PUBLIC_NETWORK=1.2.3.0/24 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mon</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host  \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=mon \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e MON_IP=1.2.3.6 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e CEPH_PUBLIC_NETWORK=1.2.3.0/24 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mon</span></div><h2>检查mon是否成功启动</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">可通过以下命令检查：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker ps|grep ceph|grep mon</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">ps aux|grep ceph|grep mon</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker logs -f mon</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker exec mon ceph –s</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><h1>Ceph OSD节点安装</h1><h2>说明</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Ceph OSD:Ceph Object Storage Device 主要功能包括:存储数据,副本数据处理,数据恢复,数据回补,平衡数据分布,并将数据相关的一些儿监控信息提供给至少2个Ceph OSD,才能有效保存两份数据.</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">OSD节点安装有两种方案，一种是在节点上挂载全新的硬盘设备，第二种是将已安装好的系统的指定目录作为OSD。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">我们这里选用第二种方式，只是因为方便。</span></div><h2>命令</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在所有需要提供OSD存储的节点上运行如下命令:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=osd \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--privileged=true \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--pid=host \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph/ \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /dev/:/dev/ \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e OSD_FORCE_ZAP=1 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e OSD_TYPE=directory   \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Osd</span></div><h2>检查OSD是否启动成功</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">参考MON的检查，相关关键字替换为osd。</span></div><h2>注意细节</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">一，可以用</span><span style="-en-paragraph:true;">JOURNAL_DIR</span><span style="-en-paragraph:true;"> 参数将日志目录移出</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">二，OSD_TYPE参数在使用新硬盘时为disk</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">三，OSD_FORCE_ZAP=1强制清空目录，这里为必要</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">四，这种方式生成的OSD指定目录为/var/lib/ceph/osd/</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">五，如果此处安装有问题，可能是不能自动建立相关pool池，可以考虑登陆docker手工执行一次./entrypoint.sh osd命令</span></div><h1>Ceph RGW节点安装</h1><h2>说明</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">RGW为Rados Gateway的缩写，ceph通过RGW为互联网云服务提供商提供对象存储服务。RGW在librados之上向应用提供访问ceph集群的RestAPI， 支持Amazon S3和openstack swift两种接口。对RGW最直接的理解就是一个协议转换层，把从上层应用符合S3或Swift协议的请求转换成rados的请求， 将数据保存在rados集群中。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">命令</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在c383上执行如下命令：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=rgw \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph  \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">rgw</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><h2>检查RGW是否成功启动</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">参考MON的检查，相关关键字替换为rgw。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;"> </span></div><h1>Ceph MDS节点安装</h1><h2>说明</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">Ceph文件系统（CEPH FS）是一个POSIX兼容的文件系统，使用Ceph的存储集群来存储其数据。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">使用Ceph的文件系统，在你的Ceph的存储集群里至少需要存在一个Ceph的元数据服务器。(MDS)</span></div><h2>命令</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在c382节点上运行:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=mds \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-e CEPHFS_CREATE=1 \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mds</span></div><h2>检查MDS是否成功启动</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">参考MON的检查，相关关键字替换为mds。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold;-en-paragraph:true;"> </span></div><h1>Ceph Mgr节点安装</h1><h2>说明</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">ceph-mgr 作为 Ceph 集群的管理进程，未来会负责整个集群的管理操作和监控。现在的部分 Monitor 功能会迁移到 ceph-mgr 中，使得 Monitor 更专注于集群的数据面控制，降低集群对于 Monitor 的要求。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在luminous版本上，mgr已成为标配，不安装成功的话，集群状态会WARN。</span></div><h2>命令</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在所有mon安装过的节点上运行以下命令：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker run \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-d --net=host  \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">--name=mgr \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /etc/ceph:/etc/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-v /var/lib/ceph/:/var/lib/ceph \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">harborip/ceph/daemon:luminous \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mgr</span></div><h2>检查Mgr是否成功启动</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">参考MON的检查，相关关键字替换为mgr。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><h2>注意细节</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">一，如果这里安装异常，或是7000端口未启用，要启用dashboard组件功能。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker exec mon ceph mgr dump</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker exec mgr ceph mgr module enable dashboard</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">二，最终系统状态和WEB(7000端口)截图如下</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">        </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><h1>挂载cephfs目录</h1><h2>内核支持挂载</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">一，明文挂载</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mount -t ceph 1.2.3.4:6789:/ /mnt/mycephfs \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">-o name=admin,secret=3545wgdsgsgfsgf</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">二，文件挂载</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mount -t ceph 192.168.1.111:6789:/ /mnt/mycephfs –o \</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">name=admin,secretfile=/etc/ceph/admin.secret</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">三，卸载目录</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">umount /mnt/mycephfs</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><h2>FUSE挂载</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><h2>在k8s中将cephfs作为volumes挂载</h2><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">一，获取admin的密文</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">docker exec mon ceph-authtool --print-key /etc/ceph/ceph.client.admin.keyring</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">二，将之用base64编码</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">echo &quot;sdfdsadfasdfasdf=&quot; | base64</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">三，生成并应用k8s secret文件</span></div><table border="1"><colgroup><col></col></colgroup><tbody><tr><td valign="top" width="540"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">apiVersion: v1</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">kind: Secret</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">metadata:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">    name: ceph-secret</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">data:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">    key: QVsdfsadfsadfPQo=</span></div></td></tr></tbody></table><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">kubectl apply -f ceph-secret</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">四，编辑deploy文件，挂载cephfs</span></div><table border="1"><colgroup><col></col></colgroup><tbody><tr><td valign="top" width="568"><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">volumes:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">        - name: applog</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">          hostPath:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            path: / apache/applogs</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">        - name: nfs4app</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">          nfs:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            server: 1.2.3.181</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            path: /app/BB</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">        - name: ceph-vol</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">          cephfs:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            monitors:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            - 1.2.3.4:6789</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            user: admin</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            secretRef:</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">              name: ceph-secret</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">            readOnly: false</span></div></td></tr></tbody></table><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"> </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">五，测试文件生成</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">在POD操作文件，在cephfs中会同步操作相应文件。</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">六，未完</span></div><h2>在k8s中将cephfs作为PVC挂载[未完]</h2><h2>将harbor中的镜像目录用cephfs来挂载[未完]</h2><div><br/></div></div></span>
</div></body></html> 