<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4417"/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div style="box-sizing:border-box;font-family:sans-serif;text-size-adjust:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="box-sizing:border-box;font-family:&quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;color:rgb(68, 68, 68);background-color:rgb(238, 238, 238);overflow-x:hidden;"><div style="box-sizing:border-box;background-color:rgb(255, 255, 255);text-align:left;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;overflow:hidden;">
				<div style="box-sizing:border-box;display:block;padding:0px 0px 12px;border-bottom:1px solid rgb(238, 238, 238);margin-bottom:20px;text-align:center;border-bottom-width:1px;">
						<div style="box-sizing:border-box;padding:5px 0px 10px;font-size:12px;text-align:left;"><span style="box-sizing:border-box;color:rgb(153, 153, 153);font-size:12px;margin-bottom:0px;">当前位置：</span><a href="https://www.centos.bz/" style="box-sizing:border-box;background:transparent;color:rgb(68, 68, 68);text-decoration:none;">Linux运维日志</a> <small style="box-sizing:border-box;font-size:12px;font-family:serif;color:rgb(187, 187, 187);margin:0px 2px;font-weight:bold;">&gt;</small> <a href="https://www.centos.bz/category/sysadmin/" style="box-sizing:border-box;background:transparent;color:rgb(68, 68, 68);text-decoration:none;">系统管理</a> <small style="box-sizing:border-box;font-size:12px;font-family:serif;color:rgb(187, 187, 187);margin:0px 2px;font-weight:bold;">&gt;</small> <span style="box-sizing:border-box;color:rgb(153, 153, 153);font-size:12px;margin-bottom:0px;">正文</span></div>
						<h1 style="box-sizing:border-box;margin:0.67em 0px;font-family:inherit;font-weight:500;color:inherit;margin-bottom:10px;font-size:26px;line-height:1.2;margin-top:5px;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(68, 68, 68);">使用fluentd实现实时收集日志文件</a></h1>
			<ul style="box-sizing:border-box;overflow:hidden;color:rgb(153, 153, 153);font-size:12px;list-style:none;margin:0px;padding:0px;">
								<li style="box-sizing:border-box;margin-right:20px;float:none;display:inline-block;">朱 茂海 发布于 2017-06-01</li>
				<li style="box-sizing:border-box;margin-right:20px;float:none;display:inline-block;">分类：<a href="https://www.centos.bz/category/sysadmin/" rel="category tag" style="box-sizing:border-box;background:transparent;color:rgb(136, 136, 136);text-decoration:underline;" title="">系统管理</a></li>
				<li style="box-sizing:border-box;margin-right:20px;float:none;display:inline-block;"><span style="box-sizing:border-box;">阅读(5530)</span></li>
				<li style="box-sizing:border-box;margin-right:20px;float:none;display:inline-block;">评论(0)</li>
				<li style="box-sizing:border-box;margin-right:20px;float:none;display:inline-block;"></li>
			</ul>
		</div>
				<div style="box-sizing:border-box;display:block;font-size:15px;line-height:25px;word-wrap:break-word;">
		

			<div style="max-width:30%;box-sizing:border-box;margin:0 0 10px 10px;background:rgb(248, 248, 248);line-height:160%;padding:12px;font-size:100%;position:relative;z-index:1000;border:1px solid rgb(221, 221, 221);float:right;"><div style="box-sizing:border-box;margin:0px 0px 3px;padding:0px;font-size:120%;font-weight:bold;">文章目录</div><span style="box-sizing:border-box;font-size:9pt;">[<a href="#" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">隐藏</a>]</span>

<ul style="box-sizing:border-box;margin:0px;padding:0px;list-style:none inside none;font-size:100%;"><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#尝试" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="尝试"><span style="box-sizing:border-box;">尝试</span></a></li><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#部署" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="部署"><span style="box-sizing:border-box;">部署</span></a><ul style="box-sizing:border-box;margin:0px;padding:0px;font-size:100%;list-style:none inside none;padding-left:1em;"><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#server端" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="server端"><span style="box-sizing:border-box;">server端</span></a></li><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#agent端" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="agent端"><span style="box-sizing:border-box;">agent端</span></a></li></ul></li><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#Dockerfile" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="Dockerfile"><span style="box-sizing:border-box;">Dockerfile</span></a><ul style="box-sizing:border-box;margin:0px;padding:0px;font-size:100%;list-style:none inside none;padding-left:1em;"><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#server端" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="server端"><span style="box-sizing:border-box;">server端</span></a></li><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#agent端" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="agent端"><span style="box-sizing:border-box;">agent端</span></a></li></ul></li><li style="box-sizing:border-box;"><a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/#参考" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;" title="参考"><span style="box-sizing:border-box;">参考</span></a></li></ul></div>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">目前线上服务使用了k8s进行部署，一个服务配置了多个副本，然后日志是挂载到宿主机器的目录的，所以当服务部署到三台机器时，这时要查看业务日志，就必须依次登录三台服务器来看日志。显然，这非常地不方便。团队想把日志收集到一个地方统一查看。于是开始尝试各种方案。</p>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:bold;line-height:18px;color:rgb(68, 68, 68);font-size:18px;margin:16px 0px;padding:10px 0px;border-bottom:1px solid rgb(238, 238, 238);">尝试</h2>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;"><strong style="box-sizing:border-box;font-weight:bold;">1. elasticsearch + fluentd + in_tail(input) + fluent-plugin-elasticsearch(output) + kibana</strong></p>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">刚开始就测试使用网络上推荐的日志收集方案，elasticsearch + fluentd + kibana,部署完成后，经过使用，并不能很方便地对日志进行检索，因为日志格式非常多，不方便对日志进行格式化，所以收集过来的日志并不是结构化的。另一个原因是elasticsearch占用的CPU很高，这个不知道什么原因，可能给的资源不够或配置不当。不过更主要是团队成员希望最好是直接把日志收集到一台服务器，然后能够使用<a href="https://www.centos.bz/tag/linux/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">linux</a>的工具，如grep,awk,less来查询日志，所以最终放弃此方案。</p>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;"><strong style="box-sizing:border-box;font-weight:bold;">2. rsyslog + fluentd + in_tail(input) + fluent-plugin-remote_syslog(output)</strong><br style="box-sizing:border-box;"/>
然后开始尝试使用fluentd来收集日志并发送到rsyslog, rsyslog使用fluentd发送过来的tag来命令文件名，但由于syslog协议的限制，tag最大为32个字符，最终无奈放弃此方案。</p>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;"><strong style="box-sizing:border-box;font-weight:bold;">3. fluentd-<a href="https://www.centos.bz/tag/agent/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">agent</a>(input: in_tail, output: forward) fluentd-<a href="https://www.centos.bz/tag/server/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">server</a>(input: forward, ouput: fluent-plugin-forest)</strong><br style="box-sizing:border-box;"/>
最后采用agent和server端都使用fluentd，agent端的input使用in_tail，ouput使用forward，server端的input使用forward，ouput使用fluent-plugin-forest，找到fluent-plugin-forest这个插件不容易，因为它支持以tag命名文件名，并非常稳定，其它的插件由于不怎么更新了，bug挺多无法使用。</p>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:bold;line-height:18px;color:rgb(68, 68, 68);font-size:18px;margin:16px 0px;padding:10px 0px;border-bottom:1px solid rgb(238, 238, 238);">部署</h2>
<h3 style="box-sizing:border-box;font-family:inherit;line-height:1.1;margin-top:20px;font-weight:bold;color:green;margin-bottom:16px;font-size:16px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:0px;">server端</h3>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;"><a href="https://www.centos.bz/tag/docker/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">docker</a> run -d  -p 24224:24224 -p 24224:24224/udp -v /var/log/worker:/var/log/worker -v /etc/localtime:/etc/localtime --name fluent-server registry.cn-hangzhou.aliyuncs.com/shengjing/fluent-server
</code></pre>
<h3 style="box-sizing:border-box;font-family:inherit;line-height:1.1;margin-top:20px;font-weight:bold;color:green;margin-bottom:16px;font-size:16px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:0px;">agent端</h3>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">在每个agent新建一个/home/fluent目录，并设置权限为777</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">mkdir -p /home/fluent
chmod 777 /home/fluent
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">这里我们使用k8s的damonset来部署</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">kubectl create -f fluentd-daemonset.yaml
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">fluentd-daemonset.yaml:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  name: fluentd
  namespace: kube-system
  labels:
    k8s-app: fluentd-logging
    version: v1
    kubernetes.io/cluster-service: &quot;true&quot;
spec:
  template:
    metadata:
      labels:
        k8s-app: fluentd-logging
        version: v1
        kubernetes.io/cluster-service: &quot;true&quot;
    spec:
      containers:
      - name: fluentd
        <a href="https://www.centos.bz/tag/image/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">image</a>: registry.cn-hangzhou.aliyuncs.com/shengjing/fluent-client
        imagePullPolicy: Always
        env:
          - name:  RSYSLOG_HOST
            value: &quot;10.29.112.24&quot;
        resources:
          limits:
            memory: 500Mi
          requests:
            cpu: 100m
            memory: 500Mi
        volumeMounts:
        - name: datlog
          mountPath: /dat/log
          readOnly: true
        - name: fluent
          mountPath: /home/fluent
        - name: localtime
          mountPath: /etc/localtime
          readOnly: true

      terminationGracePeriodSeconds: 30
      volumes:
      - name: datlog
        hostPath:
          path: /dat/log
      - name: fluent
        hostPath:
          path: /home/fluent

      - name: localtime
        hostPath:
          path: /etc/localtime
</code></pre>
<ul style="box-sizing:border-box;margin:0px 0px 16px;">
<li style="box-sizing:border-box;">其中192.168.93.201为fluentd server的ip</li>
</ul>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:bold;line-height:18px;color:rgb(68, 68, 68);font-size:18px;margin:16px 0px;padding:10px 0px;border-bottom:1px solid rgb(238, 238, 238);">Dockerfile</h2>
<h3 style="box-sizing:border-box;font-family:inherit;line-height:1.1;margin-top:20px;font-weight:bold;color:green;margin-bottom:16px;font-size:16px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:0px;">server端</h3>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">Dockerfile:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">FROM fluent/fluentd:v0.12-<a href="https://www.centos.bz/tag/debian/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">debian</a>
COPY entrypoint.sh /bin/entrypoint.sh
RUN  fluent-gem install  fluent-plugin-forest \
     &amp;&amp; chmod +x /bin/entrypoint.sh
COPY fluent.conf /fluentd/etc/
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">entrypoint.sh:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">#!/usr/bin/dumb-init /bin/sh

uid=${FLUENT_UID:-1000}

# check if a old fluent user exists and delete it
cat /etc/passwd | grep fluent
if [ $? -eq 0 ]; then
    deluser fluent
fi

# (re)add the fluent user with $FLUENT_UID
useradd -u ${uid} -o -c &quot;&quot; -m fluent
export HOME=/home/fluent

# chown home and data folder
chown -R fluent /home/fluent
chown -R fluent /fluentd

gosu fluent &quot;$@&quot;
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">fluent.conf:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">&lt;<a href="https://www.centos.bz/tag/source/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">source</a>&gt;
  @type forward
  port 24224
  bind 0.0.0.0
&lt;/source&gt;

&lt;<a href="https://www.centos.bz/tag/match/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">match</a> log.**&gt;
  @type forest
  subtype file
  &lt;template&gt;
    time_slice_format %Y%m%d
    path /var/log/worker/${tag_parts[3..-2]}
    format single_value
    flush_interval 2s
    buffer_path /tmp/buffer/${tag_parts[3..-2]}
    append true
    num_threads 1
  &lt;/template&gt;
&lt;/match&gt;

</code></pre>
<h3 style="box-sizing:border-box;font-family:inherit;line-height:1.1;margin-top:20px;font-weight:bold;color:green;margin-bottom:16px;font-size:16px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:0px;">agent端</h3>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">Dockerfile:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">FROM fluent/fluentd:v0.12-debian
COPY entrypoint.sh /bin/entrypoint.sh
RUN  chmod +x /bin/entrypoint.sh
COPY fluent.conf /fluentd/etc/
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">entrypoint.sh:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">#!/usr/bin/dumb-init /bin/sh

uid=${FLUENT_UID:-1000}

# check if a old fluent user exists and delete it
cat /etc/passwd | grep fluent
if [ $? -eq 0 ]; then
    deluser fluent
fi

# (re)add the fluent user with $FLUENT_UID
useradd -u ${uid} -o -c &quot;&quot; -m fluent
export HOME=/home/fluent

# chown home and data folder
chown -R fluent /home/fluent
chown -R fluent /fluentd

# replace FLUENTD_SERVER_HOST
sed -i &quot;s/FLUENTD_SERVER_HOST/$FLUENTD_SERVER_HOST/&quot; /fluentd/etc/fluent.conf

gosu fluent &quot;$@&quot;
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;">fluent.conf:</p>
<pre style="color:rgb(248, 248, 212);overflow:auto;border-radius:4px;box-sizing:border-box;display:block;font-size:12px;padding:10px 20px;line-height:20px;font-family:&quot;courier new&quot;;word-wrap:break-word;border:none;margin:20px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;background:rgb(74, 74, 74);"><code style="box-sizing:border-box;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:inherit;padding:0px;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0px;">&lt;source&gt;
  @type tail
  path /dat/log/**/*.log
  tag log.*
  format none
  refresh_interval 5
  read_from_head true
  limit_recently_modified 86400
  pos_file /home/fluent/dat-log.pos
&lt;/source&gt;
&lt;match log.**&gt;
  @type forward
  &lt;server&gt;
    name myserver1
    host FLUENTD_SERVER_HOST
    port 24224
    weight 60
  &lt;/server&gt;
  buffer_type file
  buffer_path /tmp/buffer_file
  flush_interval 2s
  buffer_chunk_limit 8m
  buffer_queue_limit 1000
  num_threads 4
&lt;/match&gt;
</code></pre>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:bold;line-height:18px;color:rgb(68, 68, 68);font-size:18px;margin:16px 0px;padding:10px 0px;border-bottom:1px solid rgb(238, 238, 238);">参考</h2>
<p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:16px;text-indent:0px;"><a href="https://www.centos.bz/tag/https/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">https</a>://<a href="https://www.centos.bz/tag/github/" style="box-sizing:border-box;background:transparent;color:rgb(66, 139, 202);text-decoration:underline;">github</a>.com/tagomoris/fluent-plugin-forest<br style="box-sizing:border-box;"/>
http://docs.fluentd.org/v0.12/articles/in_tail<br style="box-sizing:border-box;"/>
http://docs.fluentd.org/v0.12/articles/out_forward<br style="box-sizing:border-box;"/>
http://docs.fluentd.org/v0.12/articles/in_forward<br style="box-sizing:border-box;"/>
http://docs.fluentd.org/v0.12/articles/out_file</p>			        	<p style="color:rgb(153, 153, 153);box-sizing:border-box;margin:0px 0px 10px;clear:both;background-color:rgb(242, 242, 242);font-size:12px;padding:6px 15px 5px;border-radius:2px;text-align:center;margin-top:10px;margin-bottom:16px;text-indent:0px;">转载请保留原文链接：<a href="https://www.centos.bz/" style="box-sizing:border-box;background:transparent;color:rgb(153, 153, 153);text-decoration:none;">Linux运维日志</a> » <a href="https://www.centos.bz/2017/06/collect-log-file-realtime-with-fluentd/" style="box-sizing:border-box;background:transparent;color:rgb(153, 153, 153);text-decoration:none;">使用fluentd实现实时收集日志文件</a></p>		</div>
		           <div style="box-sizing:border-box;height:110px;position:relative;text-align:center;">
            <p style="box-sizing:border-box;margin:0px 0px 10px;"><a href="#" style="display:inline-block;background:none 0px 0px repeat scroll rgb(240, 99, 99);text-align:center;text-decoration:none;border-radius:50%;box-sizing:border-box;font-size:18px;height:75px;line-height:75px;width:75px;color:rgb(255, 255, 255);">打赏</a></p>
<p style="box-sizing:border-box;margin:0px 0px 10px;">如果此文对你有所帮助，请随意打赏鼓励作者^_^</p>
            
        </div>
       
				
		<div style="box-sizing:border-box;margin-bottom:30px;text-align:right;">
			标签：<a href="https://www.centos.bz/tag/fluentd/" rel="tag" style="box-sizing:border-box;background:transparent;color:rgb(255, 255, 255);text-decoration:none;display:inline-block;padding:3px 8px 2px;margin:0px 4px 4px 0px;font-size:12px;background-color:rgb(255, 94, 82);opacity:0.85;" title="">fluentd</a>		</div>
		<div style="box-sizing:border-box;display:block;overflow:hidden;margin-bottom:30px;font-size:14px;color:rgb(187, 187, 187);clear:both;">
			<span style="box-sizing:border-box;float:left;position:relative;width:50%;">上一篇<br style="box-sizing:border-box;"/><a href="https://www.centos.bz/2017/05/centos-7-kubeadm-install-k8s-kubernetes/" rel="prev" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(153, 153, 153);margin-right:10px;display:inline-block;">CentOS-7使用kubeadm安装配置k8s(kubernetes)</a></span>
			<span style="box-sizing:border-box;position:relative;width:50%;float:right;text-align:right;"><span style="text-align:right;position:absolute;left:0px;top:0px;height:100%;display:block;width:1px;background-color:rgb(238, 238, 238);"></span>下一篇<br style="box-sizing:border-box;"/><a href="https://www.centos.bz/2017/06/zabbix-monitor-k8s-kubernetes-abnormal-pod/" rel="next" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(153, 153, 153);display:inline-block;margin-right:0px;margin-left:10px;">使用zabbix监控K8s(kubernetes)异常POD</a></span>
		</div>
		<div style="box-sizing:border-box;overflow:hidden;clear:both;text-align:center;margin-bottom:20px;">

<ins style="box-sizing:border-box;display:inline-block;width:728px;height:0px;"><ins style="box-sizing:border-box;display:inline-table;border:none;height:0px;margin:0px;padding:0px;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins style="position:relative;box-sizing:border-box;border:none;height:0px;margin:0px;padding:0px;display:block;visibility:visible;width:728px;background-color:transparent;overflow:hidden;opacity:0;"><div style="box-sizing:border-box;max-width:100%;left:0;position:absolute;top:0;width:728px;height:90px;"><div style="-evernote-clipper-iframe:timeout;"></div></div></ins></ins></ins>
</div>		<div style="box-sizing:border-box;overflow:hidden;"><h3 style="box-sizing:border-box;font-family:inherit;font-weight:500;color:inherit;line-height:32px;font-size:20px;position:relative;margin:0px;border-bottom:2px solid rgb(238, 238, 238);"><strong style="box-sizing:border-box;font-weight:normal;border-bottom:2px solid rgb(255, 94, 82);display:inline-block;position:relative;bottom:-2px;">相关推荐</strong></h3><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;list-style:none;padding:15px 0px 0px;overflow:hidden;margin-right:-10px;"><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/09/fluentd-collect-nginx-log-to-mysql/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><span style="box-sizing:border-box;"><img src="fluentd2_files/Image.png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/></span>使用fluentd实时收到nginx日志到mysql数据库</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/fluentd-log-sync-tutorial/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><img src="fluentd2_files/Image [1].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/>Fluentd日志同步软件入门教程</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/firewalld-prevent-icmp-attack/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><img src="fluentd2_files/Image [2].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/>配置Firewalld防火墙防御ICMP攻击</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/firewalld-rule-setup/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><span style="box-sizing:border-box;"><img src="fluentd2_files/Image [3].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/></span>firewalld规则配置介绍</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/firewalld-command-intro/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><span style="box-sizing:border-box;"><img src="fluentd2_files/Image [4].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/></span>Firewalld常用命令介绍</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/centos-7-firewalld-intro/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><span style="box-sizing:border-box;"><img src="fluentd2_files/Image [5].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/></span>CentOS 7 firewalld防火墙简单配置介绍</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/centos7-systemd-supervisor/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><span style="box-sizing:border-box;"><img src="fluentd2_files/Image [6].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/></span>centos7使用systemd管理supervisor进程</a></li><li style="box-sizing:border-box;display:inline-block;vertical-align:top;width:25%;margin-bottom:20px;"><a href="https://www.centos.bz/2017/07/debian-apt-get-usage/" style="box-sizing:border-box;background:transparent;text-decoration:none;color:rgb(102, 102, 102);margin-right:10px;display:block;"><span style="box-sizing:border-box;"><img src="fluentd2_files/Image [7].png" type="image/png" data-filename="Image.png" height="156" style="box-sizing:border-box;border:0px;vertical-align:middle;max-width:100%;width:100%;margin-bottom:5px;height:156px;display:inline;" width="208"/></span>Debian系统apt-get包管理命令用法</a></li></ul></div>							</div></div></div></div></div></div>
</div>
</span>
</div></body></html> 