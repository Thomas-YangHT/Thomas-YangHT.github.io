<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4265"/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div style="outline:0px;box-sizing:border-box;text-size-adjust:100%;color:rgba(0, 0, 0, 0.75);font-family:Lato, -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-variant-ligatures:common-ligatures;line-height:1.67;-webkit-font-smoothing:antialiased;"><div style="box-sizing:inherit;outline:0px;font-family:Lato, -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:14px;line-height:1.67;background-color:rgb(245, 246, 247);color:rgba(0, 0, 0, 0.75);font-variant-ligatures:common-ligatures;-webkit-font-smoothing:antialiased;"><div style="outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="box-sizing:inherit;outline:0px;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;">
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;border-bottom:1px solid rgb(224, 224, 224);padding-top:16px;z-index:9;background-color:rgb(255, 255, 255);">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;">
				<span style="border-radius:50%;display:inline-block;width:26px;height:26px;line-height:26px;text-align:center;font-size:12px;outline:0px;box-sizing:inherit;border:1px solid rgb(244, 206, 208);color:rgb(202, 12, 22);margin-right:8px;margin-top:4px;float:left;">原</span>				<h1 style="box-sizing:inherit;outline:0px;padding:0px;margin:0.67em 0px;font-size:24px;word-break:break-all;">Docker Dockerfile详解</h1>
			</div>
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:14px;position:relative;">
				<div style="color:rgb(133, 133, 133);width:88%;height:25px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;overflow:hidden;">
																				<span style="box-sizing:inherit;outline:0px;margin-right:14px;">2017年02月19日 09:28:30</span>
					<a href="https://me.csdn.net/mozf881" style="box-sizing:inherit;outline:0px;text-decoration:none;cursor:pointer;background-color:transparent;color:rgb(120, 165, 241);margin-right:14px;" target="_blank">莫more</a>
						<span style="box-sizing:inherit;outline:0px;margin-right:14px;">阅读数：43851</span>
												
														<span style="box-sizing:inherit;outline:0px;margin-right:14px;margin-bottom:8px;font-size:12px;">
								<span style="box-sizing:inherit;outline:0px;margin-right:14px;color:rgb(77, 77, 77);">标签：</span>
																<a href="http://so.csdn.net/so/search/s.do?q=Docker&amp;t=blog" style="text-align:center;background-color:transparent;cursor:pointer;text-decoration:none;outline:0px;box-sizing:inherit;word-break:break-all;border-radius:100px;padding:0px 8px;margin-bottom:4px;display:inline-block;color:rgb(77, 77, 77);border:1px solid rgb(204, 204, 204);line-height:21px;min-width:24px;height:21px;margin-right:8px;" target="_blank">Docker																</a>
							<span style="background-color:rgb(255, 255, 255);outline:0px;box-sizing:inherit;letter-spacing:0px;line-height:20px;cursor:pointer;font-size:12px;top:0px;right:101px;width:45px;display:inline-block;color:rgb(51, 153, 234);margin-right:0px;">更多</span></span>
																					<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;margin-top:6px;margin-bottom:0px;">
								<span style="box-sizing:inherit;outline:0px;margin-right:14px;color:rgb(77, 77, 77);">个人分类：</span>
																<a href="https://blog.csdn.net/mozf881/article/category/6669088" style="box-sizing:inherit;outline:0px;text-decoration:none;cursor:pointer;background-color:transparent;display:inline-block;margin-right:24px;color:rgb(121, 165, 229);word-break:break-all;" target="_blank">docker																</a>
							</div>
																								</div>
				<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;position:absolute;top:0px;right:0px;">
														</div>
			</div>
		</div>
	</div>
	<div style="box-sizing:inherit;outline:0px;display:block;position:relative;padding-top:16px;">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;word-break:break-all;">
								            <div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;word-break:break-all;">
							
							
							<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">dockerfike快速创建自定义的Docker镜像 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
一、目录 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
1.docker典型结构 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
2.指令介绍 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
3.创建docker镜像</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">二、结构 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
DockerFile分为四部分组成：基础镜像信、维护者信息、镜像操作指令和容器启动时执行指令。例如：</p>



<pre style="margin:0px 0px 24px;margin-bottom:24px;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;line-height:22px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;word-break:break-all;border:none;background-color:rgb(246, 248, 250);padding:8px 16px 6px 56px;"><code style="font-size:14px;text-size-adjust:none;outline:0px;display:block;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:4px;color:rgb(0, 0, 0);box-sizing:border-box;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;word-break:break-all;background-color:rgb(246, 248, 250);padding:0px;"><span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);font-size:inherit;word-break:break-all;">#第一行必须指令基于的基础镜像</span>
From ubutu

<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);font-size:inherit;word-break:break-all;">#维护者信息</span>
MAINTAINER docker_user  docker_user@mail.com

<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);font-size:inherit;word-break:break-all;">#镜像的操作指令</span>
apt/sourcelist.list

RUN apt-<span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);font-size:inherit;word-break:break-all;">get</span> update &amp;&amp; apt-<span style="outline:0px;box-sizing:border-box;color:rgb(0, 0, 136);font-size:inherit;word-break:break-all;">get</span> install -y ngnix 
RUN echo <span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);font-size:inherit;word-break:break-all;">&quot;\ndaemon off;&quot;</span>&gt;&gt;/etc/ngnix/nignix.conf

<span style="outline:0px;box-sizing:border-box;color:rgb(0, 153, 0);font-size:inherit;word-break:break-all;">#容器启动时执行指令</span>
CMD /usr/sbin/ngnix
</code><ul style="position:absolute;font-size:inherit;outline:0px;box-sizing:border-box;word-break:break-all;margin:0px;list-style:none;padding:8px 0px;width:48px;background-color:rgb(238, 240, 244);top:0px;left:0px;text-align:right;"><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">1</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">2</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">3</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">4</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">5</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">6</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">7</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">8</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">9</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">10</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">11</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">12</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">13</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">14</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">15</li></ul></pre>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">三、指令 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
1、From指令 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
From 或者From :</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">DockerFile第一条必须为From指令。如果同一个DockerFile创建多个镜像时，可使用多个From指令（每个镜像一次）</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">2、MAINTAINER <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
格式为maintainer ，指定维护者的信息</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">3、RUN <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
格式为Run 或者Run [“executable” ,”Param1”, “param2”] <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
前者在shell终端上运行，即/bin/sh -C，后者使用exec运行。例如：RUN [“/bin/bash”, “-c”,”echo hello”] <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
每条run指令在当前基础镜像执行，并且提交新镜像。当命令比较长时，可以使用“/”换行。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">4、CMD指令 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
支持三种格式： <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
CMD [“executable” ,”Param1”, “param2”]使用exec执行，推荐 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
CMD command param1 param2，在/bin/sh上执行 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
CMD [“Param1”, “param2”] 提供给ENTRYPOINT做默认参数。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">每个容器只能执行一条CMD命令，多个CMD命令时，只最后一条被执行。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">5、EXPOSE</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 EXPOSE  […] 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">告诉Docker服务端容器暴露的端口号，供互联系统使用。在启动Docker时，可以通过-P,主机会自动分配一个端口号转发到指定的端口。使用-P，则可以具体指定哪个本地端口映射过来</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">例如： <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
EXPOSE 22 80 8443</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">6、ENV</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 ENV   。 指定一个环境变量，会被后续 RUN 指令使用，并在容器运行时保持。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">例如</p>



<pre style="margin:0px 0px 24px;margin-bottom:24px;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;line-height:22px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;word-break:break-all;border:none;background-color:rgb(246, 248, 250);padding:8px 16px 6px 56px;"><code style="font-size:14px;text-size-adjust:none;outline:0px;display:block;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:4px;color:rgb(0, 0, 0);box-sizing:border-box;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;word-break:break-all;background-color:rgb(246, 248, 250);padding:0px;">ENV PG_MAJOR <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);font-size:inherit;word-break:break-all;">9.3</span>
ENV PG_VERSION <span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);font-size:inherit;word-break:break-all;">9.3</span><span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);font-size:inherit;word-break:break-all;">.4</span>
RUN curl <span style="outline:0px;box-sizing:border-box;font-size:inherit;word-break:break-all;">-SL</span> http:<span style="outline:0px;box-sizing:border-box;color:rgb(136, 0, 0);font-size:inherit;word-break:break-all;">//example.com/postgres-$PG_VERSION.tar.xz | tar -xJC /usr/src/postgress &amp;&amp; …</span>
ENV PATH /usr/<span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">local</span>/postgres<span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">-</span><span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">$PG_MAJOR</span>/bin:<span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">$PATH</span></code><ul style="position:absolute;font-size:inherit;outline:0px;box-sizing:border-box;word-break:break-all;margin:0px;list-style:none;padding:8px 0px;width:48px;background-color:rgb(238, 240, 244);top:0px;left:0px;text-align:right;"><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">1</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">2</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">3</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">4</li></ul></pre>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">7、ADD <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
格式为 ADD   。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">该命令将复制指定的  到容器中的  。 其中  可以是Dockerfile所在目录的一个相对路径；也可以是一个URL；还可以是一个tar文件（自动解压为目录）。则。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">8、COPY</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 COPY   。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">复制本地主机的  （为Dockerfile所在目录的相对路径）到容器中的  。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">当使用本地目录为源目录时，推荐使用 COPY 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">9、ENTRYPOINT</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">两种格式：</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">ENTRYPOINT [“executable”, “param1”, “param2”] <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
ENTRYPOINT command param1 param2 （shell中执行）。 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
配置容器启动后执行的命令，并且不可被 docker run 提供的参数覆盖。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">每个Dockerfile中只能有一个 ENTRYPOINT ，当指定多个时，只有最后一个起效。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">10、VOLUME</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 VOLUME [“/data”] 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">创建一个可以从本地主机或其他容器挂载的挂载点，一般用来存放数据库和需要保持的数据等。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">11、USER</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 USER daemon 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">指定运行容器时的用户名或UID，后续的 RUN 也会使用指定用户。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户，例如： RUN groupadd -r postgres &amp;&amp; useradd -r -g postgres postgres 。要临时获取管理员权限可以使用 gosu ，而不推荐 sudo 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">12、WORKDIR</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 WORKDIR /path/to/workdir 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">为后续的 RUN 、 CMD 、 ENTRYPOINT 指令配置工作目录。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">可以使用多个 WORKDIR 指令，后续命令如果参数是相对路径，则会基于之前命令指定的路径。例如</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">WORKDIR /a <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
WORKDIR b <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
WORKDIR c <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
RUN pwd <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
则最终路径为 /a/b/c 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">13、ONBUILD</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为 ONBUILD [INSTRUCTION] 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">配置当所创建的镜像作为其它新创建镜像的基础镜像时，所执行的操作指令。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">例如，Dockerfile使用如下的内容创建了镜像 image-A 。</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">[…] <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
ONBUILD ADD . /app/src <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
ONBUILD RUN /usr/local/bin/python-build –dir /app/src <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
[…] <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
如果基于A创建新的镜像时，新的Dockerfile中使用 FROM image-A 指定基础镜像时，会自动执行 ONBUILD 指令内容，等价于在后面添加了两条指令。</p>

<pre style="margin:0px 0px 24px;margin-bottom:24px;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;line-height:22px;font-size:14px;font-family:Consolas, Inconsolata, Courier, monospace;word-break:break-all;border:none;background-color:rgb(246, 248, 250);padding:8px 16px 6px 56px;"><code style="font-size:14px;text-size-adjust:none;outline:0px;display:block;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:4px;color:rgb(0, 0, 0);box-sizing:border-box;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;word-break:break-all;background-color:rgb(246, 248, 250);padding:0px;">FROM image<span style="outline:0px;box-sizing:border-box;font-size:inherit;word-break:break-all;">-A</span>

<span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">#Automatically</span> run the following
ADD <span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">.</span> /app/src
RUN /usr/<span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">local</span>/bin/python<span style="outline:0px;box-sizing:border-box;font-size:inherit;word-break:break-all;">-build</span> <span style="outline:0px;box-sizing:border-box;color:rgb(79, 79, 79);font-size:inherit;word-break:break-all;">--</span>dir /app/src
使用 ONBUILD 指令的镜像，推荐在标签中注明，例如 ruby:<span style="outline:0px;box-sizing:border-box;color:rgb(0, 102, 102);font-size:inherit;word-break:break-all;">1.9</span><span style="outline:0px;box-sizing:border-box;font-size:inherit;word-break:break-all;">-onbuild</span> 。
</code><ul style="position:absolute;font-size:inherit;outline:0px;box-sizing:border-box;word-break:break-all;margin:0px;list-style:none;padding:8px 0px;width:48px;background-color:rgb(238, 240, 244);top:0px;left:0px;text-align:right;"><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">1</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">2</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">3</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">4</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">5</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">6</li><li style="outline:0px;box-sizing:border-box;font-size:inherit;list-style-type:disc;word-break:break-all;padding:0px 8px;margin:0px;list-style:none;color:rgb(153, 153, 153);">7</li></ul></pre>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">三、创建镜像 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
通过Docker Build 创建镜像。 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
命令读取指定路径下（包括子目录）所有的Dockefile，并且把目录下所有内容发送到服务端，由服务端创建镜像。另外可以通过创建.dockerignore文件（每一行添加一个匹配模式）让docker忽略指定目录或者文件</p>

<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;text-align:justify;word-break:break-all;">格式为Docker Build [选项] 路径 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
需要制定标签信息，可以使用-t选项 <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
例如：Dockerfile路径为 /tmp/docker_build/，生成镜像的标签为build_repo/my_images <br style="outline:0px;box-sizing:border-box;word-break:break-all;"/>
$dudo docker build -t build_repo/my_images /tmp/docker_build/</p>            </div>
						
                <span style="display:block;height:0px;visibility:hidden;clear:both;"> </span></div>
				
        	</div>
	
</div></span></div></div></div></div>
</div>
</span>
</div></body></html> 