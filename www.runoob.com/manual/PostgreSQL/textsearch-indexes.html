<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>GiST和GIN索引类型</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="全文检索" HREF="http://school.yunwei.edu/manual/PostgreSQL/textsearch.html"><LINK REL="PREVIOUS" TITLE="测试和调试文本搜索" HREF="textsearch-debugging.html"><LINK REL="NEXT" TITLE="psql支持" HREF="textsearch-psql.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/textsearch.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="测试和调试文本搜索" HREF="textsearch-debugging.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/textsearch.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 12. 全文检索</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="psql支持" HREF="textsearch-psql.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="TEXTSEARCH-INDEXES">12.9. GiST和GIN索引类型</A></H1><P>
有两种类型的索引可以用于加快全文搜索。注意全文检索不一定非要使用索引。
但是在规则基础上搜索列的情况下，索引往往是可取的。
<P></P></P><DIV CLASS="VARIABLELIST"><DL><DT><TT CLASS="LITERAL">CREATE INDEX <TT CLASS="REPLACEABLE"><I>name</I></TT> ON <TT CLASS="REPLACEABLE"><I>table</I></TT> USING gist(<TT CLASS="REPLACEABLE"><I>column</I></TT>);</TT></DT><DD><P>
创建以GiST（通用搜索树）为基础的索引，<TT CLASS="REPLACEABLE"><I>column</I></TT>可以是<TT CLASS="TYPE">tsvector</TT> or
<TT CLASS="TYPE">tsquery</TT> 类型。
</P></DD><DT><TT CLASS="LITERAL">CREATE INDEX <TT CLASS="REPLACEABLE"><I>name</I></TT> ON <TT CLASS="REPLACEABLE"><I>table</I></TT> USING gin(<TT CLASS="REPLACEABLE"><I>column</I></TT>);</TT></DT><DD><P> 创建以GIN（基因倒排索引）为基础的索引，<TT CLASS="REPLACEABLE"><I>column</I></TT>必须是<TT CLASS="TYPE">tsvector</TT>类型。</P></DD></DL></DIV><P>
</P><P> 在两个索引类型之间有着巨大的性能差异，因此了解它们的特性是很重要的。</P><P> GiST索引是有<I CLASS="FIRSTTERM">损耗的</I>，这意味着该索引可能会产生错误的匹配，
并且有必要检查实际的表行消除这种错误匹配（<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>需要时自动执行）。
GiST索引是有损耗的，因为每个文档在索引中通过一个固定长度的标签进行表示。
它是通过散列每个单词到一个n位的字符串的单一的点产生，所有这些位OR-ed一起产生一个n位的文件标签。
当两个单词散列到相同点的位置，将有一个错误匹配。如果查询中的所有单词匹配（真实的或错误的），
则必须检索表行查看匹配是否是正确的。</P><P> 数据丢失导致了性能下降，由于表记录的不必要的获取，产生了错误的匹配。
由于随机访问表记录是缓慢的，这限制了GiST索引的效能。错误匹配的可能性取决于几个因素，
特别是独特词的数量，所以推荐使用词典来降低这些数量。</P><P> GIN索引并没有损耗标准查询，但它们的性能取决于对数独特的单词数。
（然而，GIN索引只存储<TT CLASS="TYPE">tsvector</TT>值的字（词），而不是它们的权重标签。因此，
当使用涉及权重的查询时，需要复查一个表行。）</P><P>
在选择要使用的索引类型时，GiST或者GIN考虑这些性能上的差异：
<P></P></P><UL COMPACT="COMPACT"><LI STYLE="list-style-type: disc"><P>
GIN索引查找比GiST快约三倍
</P></LI><LI STYLE="list-style-type: disc"><P> GIN索引建立比GIST需要大约三倍的时间。</P></LI><LI STYLE="list-style-type: disc"><P> GIN索引更新比GiST索引速度慢，但如果快速更新支持无效，则慢了大约10倍（详情请见节<A HREF="gin-implementation.html#GIN-FAST-UPDATE">第 57.3.1 &#33410;</A>）</P></LI><LI STYLE="list-style-type: disc"><P> GIN索引比GiST索引大两到三倍</P></LI></UL><P>
</P><P> 一般来说，<ACRONYM CLASS="ACRONYM">GIN</ACRONYM>索引对静态数据是最好的，因为查找速度很快。对于动态数据，
GiST索引更新比较快。具体而言，<ACRONYM CLASS="ACRONYM">GiST</ACRONYM>索引非常适合动态数据，并且如果独特的字（词）在100,000以下，
则比较快，而<ACRONYM CLASS="ACRONYM">GIN</ACRONYM>索引将处理100,000+词汇，但是更新比较慢。 </P><P> 请注意，<ACRONYM CLASS="ACRONYM">GIN</ACRONYM>索引编译时间通常可以通过增加<A HREF="runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</A>改进，
而<ACRONYM CLASS="ACRONYM">GiST</ACRONYM>索引编译时间对参数不敏感。 </P><P> 大集合的分区以及GiST和GIN索引的合理使用允许非常快速的搜索与在线升级的实现。
分区可以在数据库级别使用表继承，或者在服务器发布文档并且使用<A HREF="dblink.html">dblink</A>模块采集搜索结果。
后者是可能的，因为相关函数只使用本地信息。</P></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="textsearch-debugging.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="textsearch-psql.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">测试和调试文本搜索</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/textsearch.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><SPAN CLASS="APPLICATION">psql</SPAN>支持</TD></TR></TABLE></DIV></BODY></HTML>
