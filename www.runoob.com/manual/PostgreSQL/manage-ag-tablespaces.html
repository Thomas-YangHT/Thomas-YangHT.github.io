<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>表空间</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="管理数据库" HREF="http://school.yunwei.edu/manual/PostgreSQL/managing-databases.html"><LINK REL="PREVIOUS" TITLE="删除数据库" HREF="manage-ag-dropdb.html"><LINK REL="NEXT" TITLE="区域" HREF="http://school.yunwei.edu/manual/PostgreSQL/charset.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/manage-ag.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="删除数据库" HREF="manage-ag-dropdb.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/managing-databases.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 21. 管理数据库</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="区域" HREF="http://school.yunwei.edu/manual/PostgreSQL/charset.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="MANAGE-AG-TABLESPACES">21.6. 表空间</A></H1><P><SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>里的表空间允许数据库管理员在文件系统里定义那些代表数据库对象的文件存放位置。
一旦创建了表空间，那么就可以在创建数据库对象的时候引用它。</P><P>通过使用表空间，管理员可以控制一个<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>安装的磁盘布局。
这么做至少有两个用处。首先，如果初始化集群所在的分区或者卷用光了空间，
而又不能扩展，那么表空间可以在一个不同的分区上创建和使用，
直到系统可以重新配置。</P><P>第二，表空间允许管理员根据数据库对象的使用模式安排数据位置，从而优化性能。比如，
一个很频繁使用的索引可以放在非常快并且非常可靠的磁盘上，比如一种非常贵的固态设备。而同时，
一个存储归档的数据，很少使用的或者对性能要求不高的表可以存储在一个便宜但比较慢的磁盘系统上。</P><P>要定义一个表空间，使用<A HREF="sql-createtablespace.html">CREATE TABLESPACE</A>命令，比如：
</P><PRE CLASS="PROGRAMLISTING">CREATE TABLESPACE fastspace LOCATION '/mnt/sda1/postgresql/data';</PRE><P>
这个位置必须是一个现有的空目录，并且属于<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>系统用户。
所有随后在该表空间创建的对象都将被存放在这个目录下的文件里。
</P><DIV CLASS="NOTE"><BLOCKQUOTE CLASS="NOTE"><P><B>&#27880;&#24847;: </B>通常在一个逻辑文件系统上建立多个表空间没有什么意义，
因为无法控制一个逻辑文件系统里不同文件的位置。不过，<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
并不做这方面的任何强制，并且它实际上并不知道文件系统边界。
它只知道在指定的目录里存储文件。</P></BLOCKQUOTE></DIV><P>创建表空间本身必须用数据库超级用户身份进行，但之后你就可以允许普通数据库用户利用它了。
要做这件事情，在表空间上给这些用户授予<TT CLASS="LITERAL">CREATE</TT>权限。</P><P>表、索引和整个数据库都可以放在特定的表空间里。想要这么做的话，
在给定表空间上有<TT CLASS="LITERAL">CREATE</TT>权限的用户必须把表空间的名字以一个参数的形式传递给相关的命令。
比如，下面的命令在表空间<TT CLASS="LITERAL">space1</TT>上创建一个表：
</P><PRE CLASS="PROGRAMLISTING">CREATE TABLE foo(i int) TABLESPACE space1;</PRE><P>
</P><P>另外，还可以使用<A HREF="runtime-config-client.html#GUC-DEFAULT-TABLESPACE">default_tablespace</A>参数：
</P><PRE CLASS="PROGRAMLISTING">SET default_tablespace = space1;
CREATE TABLE foo(i int);</PRE><P>
只要<TT CLASS="VARNAME">default_tablespace</TT>被设置为非空字符串，
那么它就为没有明确使用<TT CLASS="LITERAL">TABLESPACE</TT>子句的<TT CLASS="COMMAND">CREATE TABLE</TT>
和<TT CLASS="COMMAND">CREATE INDEX</TT>命令提供一个隐含的子句。
</P><P>也有一个<A HREF="runtime-config-client.html#GUC-TEMP-TABLESPACES">temp_tablespaces</A>参数，决定临时表和索引的放置，
就和用于像存储大数据集这样的目的临时文件一样。这可能是一个表空间名字的列表，
而不是只有一个名字，所以与临时对象相关联的负载可以散布到多个表空间中。
每次创建临时对象时选择一个随机的成员列表。</P><P>与一个数据库相关联的表空间用于存储该数据库的系统表。另外，
如果没有给出<TT CLASS="LITERAL">TABLESPACE</TT>子句，并且没有通过<TT CLASS="VARNAME">default_tablespace</TT>
或<TT CLASS="VARNAME">temp_tablespaces</TT>（视情况而定）指定其他选项，那么在数据库中创建表，
索引和临时文件时使用的是缺省表空间。如果创建数据库时没有给它声明一个表空间，
那么它使用与它拷贝的模版数据库相同的表空间。</P><P>当数据库集群初始化时，自动创建两个表空间。<TT CLASS="LITERAL">pg_global</TT>表空间用于共享的系统表。
<TT CLASS="LITERAL">pg_default</TT>是<TT CLASS="LITERAL">template1</TT>和<TT CLASS="LITERAL">template0</TT>数据库的缺省表空间
(因此，这个表空间也将是任何其它数据库的缺省表空间，除非在<TT CLASS="COMMAND">CREATE DATABASE</TT>
中通过<TT CLASS="LITERAL">TABLESPACE</TT>子句重写)。</P><P>创建了表空间之后，它就可以用于任何数据库，只要请求的用户有足够权限。
这意味着除非我们把使用这个表空间的所有数据库里的所有对象都删除掉，否则我们不能删除该表空间。</P><P>要删除一个空的表空间，使用<A HREF="sql-droptablespace.html">DROP TABLESPACE</A>命令。</P><P>检查<A HREF="catalog-pg-tablespace.html"><TT CLASS="STRUCTNAME">pg_tablespace</TT></A>
系统表就可以获取现有的表空间，比如
</P><PRE CLASS="SYNOPSIS">SELECT spcname FROM pg_tablespace;</PRE><P>
<A HREF="app-psql.html"><SPAN CLASS="APPLICATION">psql</SPAN></A>程序的<TT CLASS="LITERAL">\db</TT>元命令也可以用于列出现有表空间。
</P><P>为了简化表空间的实现，<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>使用了符号连接。
这就意味着表空间<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">只能</I></SPAN>在支持符号连接的系统上使用。</P><P>目录<TT CLASS="FILENAME">$PGDATA/pg_tblspc</TT>包含指向集群里定义的每个非内置表空间的符号连接。
尽管我们不建议，但是我们还是可能通过手工重定义这些连接来调整表空间的布局。
在服务器运行的时候不要这么干。注意在PostgreSQL 9.1及以前，你仍需要用新的位置更新
<TT CLASS="STRUCTNAME">pg_tablespace</TT>表。如果你不这么做，<TT CLASS="LITERAL">pg_dump</TT>将继续显示旧的表空间位置。</P></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="manage-ag-dropdb.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/charset.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">删除数据库</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/managing-databases.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">区域</TD></TR></TABLE></DIV></BODY></HTML>
