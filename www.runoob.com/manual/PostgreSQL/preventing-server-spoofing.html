<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>防止服务器欺骗</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="服务器设置和操作" HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime.html"><LINK REL="PREVIOUS" TITLE="升级一个 PostgreSQL 集群" HREF="upgrading.html"><LINK REL="NEXT" TITLE="加密选项" HREF="encryption-options.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/runtime.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="升级一个 PostgreSQL 集群" HREF="upgrading.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 17. 服务器设置和操作</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="加密选项" HREF="encryption-options.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="PREVENTING-SERVER-SPOOFING">17.7. 防止服务器欺骗</A></H1><P>当服务器正在运行时，恶意用户代替正常的数据库服务器是不可能的。然而，当服务器关闭时，
本地用户通过启动他们自己的服务器欺骗正常的服务器是可能的。行骗服务器可以读取客户端发来的查询和密码，
但不能返回任何数据，因为<TT CLASS="VARNAME">PGDATA</TT>目录因为目录存取权限仍然是安全的。
因为任何用户都可以启动一个数据库服务器，所以欺骗是可能的；客户端不能识别无效的服务器，
除非它是专门配置的。</P><P>为<TT CLASS="LITERAL">local</TT>连接防止欺骗的最简单的方法是使用Unix域套接字目录
(<A HREF="runtime-config-connection.html#GUC-UNIX-SOCKET-DIRECTORIES">unix_socket_directories</A>)，这个目录只为受信任的本地用户写入了权限。
如果你担心一些应用可能仍然参考<TT CLASS="FILENAME">/tmp</TT>为套接字文件，并且因此很容易受欺骗，
那么在操作系统启动时创建一个符号链接<TT CLASS="FILENAME">/tmp/.s.PGSQL.5432</TT>指向重定位的套接字文件。
您还可能需要修改<TT CLASS="FILENAME">/tmp</TT>清理脚本以防止删除符号链接。</P><P>要在TCP连接上防止欺骗，最好的解决方法是使用SSL认证，并确保客户检查服务器的证书。
要做到这一点，服务器必须配置为只接受<TT CLASS="LITERAL">hostssl</TT>连接(<A HREF="auth-pg-hba-conf.html">第 19.1 &#33410;</A>)，
并且有SSL秘钥和证书文件(<A HREF="ssl-tcp.html">第 17.9 &#33410;</A>)。TCP客户必须使用<TT CLASS="LITERAL">sslmode=verify-ca</TT>
或<TT CLASS="LITERAL">verify-full</TT>连接，并且有适当的根证书文件安装(<A HREF="libpq-ssl.html#LIBQ-SSL-CERTIFICATES">第 31.18.1 &#33410;</A>)。</P></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="upgrading.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="encryption-options.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">升级一个 <SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN> 集群</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">加密选项</TD></TR></TABLE></DIV></BODY></HTML>
