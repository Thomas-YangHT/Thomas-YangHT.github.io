<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>介绍</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="索引" HREF="http://school.yunwei.edu/manual/PostgreSQL/indexes.html"><LINK REL="PREVIOUS" TITLE="索引" HREF="http://school.yunwei.edu/manual/PostgreSQL/indexes.html"><LINK REL="NEXT" TITLE="索引类型" HREF="indexes-types.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/indices.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="索引" HREF="http://school.yunwei.edu/manual/PostgreSQL/indexes.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/indexes.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 11. 索引</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="索引类型" HREF="indexes-types.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="INDEXES-INTRO">11.1. 介绍</A></H1><P>假设有像下面这样一个表：
</P><PRE CLASS="PROGRAMLISTING">CREATE TABLE test1 (
    id integer,
    content varchar
);</PRE><P>
发出大量下面这样的语句进行查询：
</P><PRE CLASS="PROGRAMLISTING">SELECT content FROM test1 WHERE id = <TT
CLASS="REPLACEABLE"
><I
>constant</I
></TT
>;</PRE><P>
通常，数据库系统不得不一行一行地扫描整个<TT CLASS="STRUCTNAME">test1</TT>
表以寻找所有匹配的记录。如果在<TT CLASS="STRUCTNAME">test1</TT>里面有许多行，
但是只返回少数几行(可能是零行或一行)，那么上面这个方法可就很差劲了。
如果我们让数据库系统在<TT CLASS="STRUCTFIELD">id</TT>列上维护一个索引用于定位匹配的行。
这样，数据库系统只需要在搜索树中走少数的几层就可以找到匹配行。
</P><P>在大多数非小说的书籍里面都使用了类似这样的方法：在书的背后收集着读者会经常查找的术语和概念的索引，
并按照字母顺序排列。有兴趣的读者可以快速地扫描该索引并且切换到合适的页，
因此不用阅读整本书就能查找到感兴趣的位置。作者的任务之一就是预计哪些项是读者最需要查找的东西，
与之类似，预计哪些索引可以带来便利也是数据库程序员的任务。</P><P>下面的命令可以用于在<TT CLASS="STRUCTFIELD">id</TT>列上创建前面讨论过的索引：
</P><PRE CLASS="PROGRAMLISTING">CREATE INDEX test1_id_index ON test1 (id);</PRE><P>
索引名字<TT CLASS="STRUCTNAME">test1_id_index</TT>可以自由选择，
但是应该选那些稍后可以让你回忆起索引含义的名字。
</P><P>要删除一个索引，使用<TT CLASS="COMMAND">DROP INDEX</TT>命令。
你可以在任何时候向表里增加索引或者从表中删除索引。</P><P>一旦你创建了索引，那么就不需要更多干涉了：当表有修改时系统会更新索引，
并且当系统认为用索引比顺序的表扫描快的时候它就会使用索引。
不过你可能必须经常性地运行<TT CLASS="COMMAND">ANALYZE</TT>命令以更新统计信息，
好让查询规划器能够做出训练有素的判断。参见<A HREF="http://school.yunwei.edu/manual/PostgreSQL/performance-tips.html">第 14 &#31456;</A>
获取关于如何获知是否使用了索引的信息，以及在什么时候、什么原因下规划器会决定
<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">不</I></SPAN>使用索引。</P><P>索引对带搜索条件的<TT CLASS="COMMAND">UPDATE</TT>和<TT CLASS="COMMAND">DELETE</TT>命令也有好处。
索引更可以用于表连接查询。因此，如果你定义了索引的列是连接条件的一部分，
那么它也可以显著提高连接的查询速度。</P><P>在一个巨大的表上创建索引可能会消耗大量的时间。缺省时，<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
允许在创建索引的同时读取表(<TT CLASS="COMMAND">SELECT</TT>语句)，但是写入表(<TT CLASS="COMMAND">INSERT</TT>,
<TT CLASS="COMMAND">UPDATE</TT>, <TT CLASS="COMMAND">DELETE</TT>)的动作将被阻塞到索引创建完毕。
在生产环境下这种阻塞通常是不可接受的，因此也允许在创建索引的同时写入表，
但是有一些警告需要注意，更多信息参见<A HREF="sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY"><I>并发建立索引</I></A>。</P><P>创建索引之后，它必须和表保持同步。这些操作增加了数据操作的负荷。
因此我们应该把那些非关键或者根本用不上的索引删除掉。</P></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/indexes.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="indexes-types.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">索引</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/indexes.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">索引类型</TD></TR></TABLE></DIV></BODY></HTML>
