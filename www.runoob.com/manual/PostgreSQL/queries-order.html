<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>行排序</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="查询" HREF="http://school.yunwei.edu/manual/PostgreSQL/queries.html"><LINK REL="PREVIOUS" TITLE="组合查询" HREF="queries-union.html"><LINK REL="NEXT" TITLE="LIMIT和OFFSET" HREF="queries-limit.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/queries.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="组合查询" HREF="queries-union.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/queries.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 7. 查询</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="LIMIT和OFFSET" HREF="queries-limit.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="QUERIES-ORDER">7.5. 行排序</A></H1><P>在查询生成输出表之后，也就是在处理完选择列表之后，你还可以对输出表进行排序。
如果没有排序，那么行将以不可预测的顺序返回(实际顺序将取决于扫描和连接规划类型和在磁盘上的顺序，
但是肯定不能依赖这些东西)。确定的顺序只能在明确地使用了排序步骤之后才能保证。</P><P><TT CLASS="LITERAL">ORDER BY</TT>子句用于声明排序顺序:
</P><PRE CLASS="SYNOPSIS">SELECT <TT
CLASS="REPLACEABLE"
><I
>select_list</I
></TT
>
    FROM <TT
CLASS="REPLACEABLE"
><I
>table_expression</I
></TT
>
    ORDER BY <TT
CLASS="REPLACEABLE"
><I
>sort_expression1</I
></TT
> [<SPAN
CLASS="OPTIONAL"
>ASC | DESC</SPAN
>] [<SPAN
CLASS="OPTIONAL"
>NULLS { FIRST | LAST }</SPAN
>]
             [<SPAN
CLASS="OPTIONAL"
>, <TT
CLASS="REPLACEABLE"
><I
>sort_expression2</I
></TT
> [<SPAN
CLASS="OPTIONAL"
>ASC | DESC</SPAN
>] [<SPAN
CLASS="OPTIONAL"
>NULLS { FIRST | LAST }</SPAN
>] ...</SPAN
>]</PRE><P>
sort_expression 是任何可用于选择列表的表达式，例如：
</P><PRE CLASS="PROGRAMLISTING">SELECT a, b FROM table1 ORDER BY a + b, c;</PRE><P>
如果指定了多个排序表达式，那么仅在前面的表达式排序相等的情况下才使用后面的表达式做进一步排序。
每个表达式都可以跟一个可选的<TT CLASS="LITERAL">ASC</TT>(升序，默认) 或<TT CLASS="LITERAL">DESC</TT>(降序)以设置排序方向。
升序先输出小的数值，这里的<SPAN CLASS="QUOTE">"小"</SPAN>是以<TT CLASS="LITERAL">&lt;</TT>操作符的角度定义的。
类似的是，降序是以<TT CLASS="LITERAL">&gt;</TT>操作符来判断的。
<A NAME="AEN4176" HREF="queries-order.html#FTN.AEN4176"><SPAN CLASS="footnote">[1]</SPAN></A>
</P><P><TT CLASS="LITERAL">NULLS FIRST</TT>和<TT CLASS="LITERAL">NULLS LAST</TT>选项可以决定在排序操作中在
non-null 值之前还是之后。默认情况下，空值大于任何非空值；也就是说，<TT CLASS="LITERAL">DESC</TT>
排序默认是<TT CLASS="LITERAL">NULLS FIRST</TT>，否则为<TT CLASS="LITERAL">NULLS LAST</TT>。</P><P>注意，排序选项对于每个排序列是相对独立的。例如<TT CLASS="LITERAL">ORDER BY x, y DESC</TT>
意思是说<TT CLASS="LITERAL">ORDER BY x ASC, y DESC</TT>，不同于<TT CLASS="LITERAL">ORDER BY x DESC, y DESC</TT>。</P><P>一个<TT CLASS="REPLACEABLE"><I>sort_expression</I></TT>也可以是字段名或字段编号，如:
</P><PRE CLASS="PROGRAMLISTING">SELECT a + b AS sum, c FROM table1 ORDER BY sum;
SELECT a, max(b) FROM table1 GROUP BY a ORDER BY 1;</PRE><P>
都按照第一个字段进行排序。需要注意的是，输出字段名必须是独立的(不允许在表达式中使用)。
比如，下面的语句是<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">错误</I></SPAN>的：
</P><PRE CLASS="PROGRAMLISTING">SELECT a + b AS sum, c FROM table1 ORDER BY sum + c;          -- 错误的</PRE><P>
这样的限制主要是为了避免歧义。另外，如果某个排序表达式能够同时匹配输出字段名和表表达式中的字段名，
也会导致歧义(此时使用输出字段名)。当然，这种情况仅在你使用了<TT CLASS="LITERAL">AS</TT>
重命名输出字段并且恰好与其它表的字段同名的时候才会发生。
</P><P><TT CLASS="LITERAL">ORDER BY</TT>可以应用于<TT CLASS="LITERAL">UNION</TT>, <TT CLASS="LITERAL">INTERSECT</TT>,<TT CLASS="LITERAL">EXCEPT</TT>
组合的计算结果，不过在这种情况下，只允许按照字段的名字或编号进行排序，而不允许按照表达式进行排序。</P></DIV><H3 CLASS="FOOTNOTES">&#22791;&#27880;</H3><TABLE BORDER="0" CLASS="FOOTNOTES" WIDTH="100%"><TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="5%"><A NAME="FTN.AEN4176" HREF="queries-order.html#AEN4176"><SPAN CLASS="footnote">[1]</SPAN></A></TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="95%"><P>事实上，<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>使用<I CLASS="FIRSTTERM">默认的B-tree操作符类</I>
为表达式的数据类型确定<TT CLASS="LITERAL">ASC</TT>和<TT CLASS="LITERAL">DESC</TT>排序顺序。
一般来说，数据类型将被转换为适合于 <TT CLASS="LITERAL">&lt;</TT>和
<TT CLASS="LITERAL">&gt;</TT>操作符进行排序。但是对于用户自定义的数据类型可以不必如此。</P></TD></TR></TABLE><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="queries-union.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="queries-limit.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">组合查询</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/queries.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><TT CLASS="LITERAL">LIMIT</TT>和<TT CLASS="LITERAL">OFFSET</TT></TD></TR></TABLE></DIV></BODY></HTML>
