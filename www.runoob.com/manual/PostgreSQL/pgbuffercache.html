<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>pg_buffercache</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="额外提供的模块" HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html"><LINK REL="PREVIOUS" TITLE="passwordcheck" HREF="passwordcheck.html"><LINK REL="NEXT" TITLE="pgcrypto" HREF="pgcrypto.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/pgbuffercache.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="passwordcheck" HREF="passwordcheck.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#38468;&#24405; F. 额外提供的模块</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="pgcrypto" HREF="pgcrypto.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="PGBUFFERCACHE">F.24. pg_buffercache</A></H1><P><TT CLASS="FILENAME">pg_buffercache</TT>模块提供实时检查共享缓存内发生了什么的用途。</P><P>该模块提供一个C函数<CODE CLASS="FUNCTION">pg_buffercache_pages</CODE>，该函数返回一个记录集，
加上一个包裹该函数为了方便使用的视图<TT CLASS="STRUCTNAME">pg_buffercache</TT>。</P><P>缺省情况下取消这两种的公共访问，以防隐藏的安全问题。</P><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN147962">F.24.1. <TT CLASS="STRUCTNAME">pg_buffercache</TT> 视图</A></H2><P>被视图暴露的字段的定义显示在<A HREF="pgbuffercache.html#PGBUFFERCACHE-COLUMNS">&#34920; F-14</A>里。</P><DIV CLASS="TABLE"><A NAME="PGBUFFERCACHE-COLUMNS"></A><P><B>&#34920; F-14. <TT CLASS="STRUCTNAME">pg_buffercache</TT> 字段</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><COL><THEAD><TR><TH>名字</TH><TH>类型</TH><TH>引用</TH><TH>描述</TH></TR></THEAD><TBODY><TR><TD><TT CLASS="STRUCTFIELD">bufferid</TT></TD><TD><TT CLASS="TYPE">integer</TT></TD><TD>&nbsp;</TD><TD>ID, 范围为 1..<TT CLASS="VARNAME">shared_buffers</TT></TD></TR><TR><TD><TT CLASS="STRUCTFIELD">relfilenode</TT></TD><TD><TT CLASS="TYPE">oid</TT></TD><TD><TT CLASS="LITERAL">pg_class.relfilenode</TT></TD><TD>关系的文件节点号</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">reltablespace</TT></TD><TD><TT CLASS="TYPE">oid</TT></TD><TD><TT CLASS="LITERAL">pg_tablespace.oid</TT></TD><TD>关系的表空间OID</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">reldatabase</TT></TD><TD><TT CLASS="TYPE">oid</TT></TD><TD><TT CLASS="LITERAL">pg_database.oid</TT></TD><TD>关系的数据库OID</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">relblocknumber</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>&nbsp;</TD><TD>关系的页码</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">relforknumber</TT></TD><TD><TT CLASS="TYPE">smallint</TT></TD><TD>&nbsp;</TD><TD>关系的分支编号; 参阅
<TT CLASS="FILENAME">include/storage/relfilenode.h</TT></TD></TR><TR><TD><TT CLASS="STRUCTFIELD">isdirty</TT></TD><TD><TT CLASS="TYPE">boolean</TT></TD><TD>&nbsp;</TD><TD>页脏了吗？</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">usagecount</TT></TD><TD><TT CLASS="TYPE">smallint</TT></TD><TD>&nbsp;</TD><TD>时钟下摆访问计数</TD></TR></TBODY></TABLE></DIV><P>在共享缓存中每个缓冲区都有一行记录。未使用的缓冲区显示为所有字段为空，除了<TT CLASS="STRUCTFIELD">bufferid</TT>。
共享的系统目录显示为属于数据库零。</P><P>因为缓存被所有数据库共享，通常有几页的关系不属于当前数据库。
这意味着某些行在<TT CLASS="STRUCTNAME">pg_class</TT>中没有匹配的连接行，
或者甚至有不正确的连接。如果你尝试连接<TT CLASS="STRUCTNAME">pg_class</TT>，
限制连接到的行的<TT CLASS="STRUCTFIELD">reldatabase</TT>等于当前数据库的OID或0是个好主意。</P><P>当访问<TT CLASS="STRUCTNAME">pg_buffercache</TT>视图时，认为内部缓冲区锁管理器足够长，
能够拷贝视图将显示的所有的缓冲区状态数据。这保证了视图产生一个一致的结果集，
当不再需要阻塞正常的缓冲区活动时。但是，如果频繁的阅读这个视图，
可能会对数据库性能造成一些影响。</P></DIV><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN148047">F.24.2. 示例输出</A></H2><PRE CLASS="SCREEN">regression=# SELECT c.relname, count(*) AS buffers
             FROM pg_buffercache b INNER JOIN pg_class c
             ON b.relfilenode = pg_relation_filenode(c.oid) AND
                b.reldatabase IN (0, (SELECT oid FROM pg_database
                                      WHERE datname = current_database()))
             GROUP BY c.relname
             ORDER BY 2 DESC
             LIMIT 10;

             relname             | buffers
---------------------------------+---------
 tenk2                           |     345
 tenk1                           |     141
 pg_proc                         |      46
 pg_class                        |      45
 pg_attribute                    |      43
 pg_class_relname_nsp_index      |      30
 pg_proc_proname_args_nsp_index  |      28
 pg_attribute_relid_attnam_index |      26
 pg_depend                       |      22
 pg_depend_reference_index       |      20
(10 rows)</PRE></DIV><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN148050">F.24.3. 作者</A></H2><P> Mark Kirkwood <CODE CLASS="EMAIL">&#60;<A HREF="mailto:markir@paradise.net.nz">markir@paradise.net.nz</A>&#62;</CODE>
</P><P>设计建议：Neil Conway <CODE CLASS="EMAIL">&#60;<A HREF="mailto:neilc@samurai.com">neilc@samurai.com</A>&#62;</CODE></P><P>调试建议：Tom Lane <CODE CLASS="EMAIL">&#60;<A HREF="mailto:tgl@sss.pgh.pa.us">tgl@sss.pgh.pa.us</A>&#62;</CODE></P></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="passwordcheck.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="pgcrypto.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">passwordcheck</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">pgcrypto</TD></TR></TABLE></DIV></BODY></HTML>
