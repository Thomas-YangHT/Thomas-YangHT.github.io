<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>二进制数据类型</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="数据类型" HREF="http://school.yunwei.edu/manual/PostgreSQL/datatype.html"><LINK REL="PREVIOUS" TITLE="字符类型" HREF="datatype-character.html"><LINK REL="NEXT" TITLE="日期/时间类型" HREF="datatype-datetime.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/datatype.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="字符类型" HREF="datatype-character.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/datatype.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 8. 数据类型</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="日期/时间类型" HREF="datatype-datetime.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="DATATYPE-BINARY">8.4. 二进制数据类型</A></H1><P><TT CLASS="TYPE">bytea</TT>数据类型允许存储二进制字符串。参阅<A HREF="datatype-binary.html#DATATYPE-BINARY-TABLE">&#34920; 8-6</A>。</P><DIV CLASS="TABLE"><A NAME="DATATYPE-BINARY-TABLE"></A><P><B>&#34920; 8-6. 二进制数据类型</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><THEAD><TR><TH>名字</TH><TH>存储空间</TH><TH>描述</TH></TR></THEAD><TBODY><TR><TD><TT CLASS="TYPE">bytea</TT></TD><TD>1或4字节加上实际的二进制字符串</TD><TD>变长的二进制字符串</TD></TR></TBODY></TABLE></DIV><P>二进制字符串是一个字节序列。二进制字符串和普通字符字符串的区别有两个：
首先，二进制字符串完全可以存储字节零值以及其它<SPAN CLASS="QUOTE">"不可打印的"</SPAN>
字节(定义在 32 到 126 范围之外的字节)。字符串不允许字节零值，
并且也不允许那些不符合选定的字符集编码的非法字节值或者字节序列。
第二，对二进制字符串的处理实际上就是处理字节，而对字符串的处理则取决于区域设置。
简单说，二进制字符串适用于存储那些程序员认为是<SPAN CLASS="QUOTE">"原始字节"</SPAN>的数据，
而字符串适合存储文本。</P><P><TT CLASS="TYPE">bytea</TT>类型支持两种输入输出的外部格式：<SPAN CLASS="QUOTE">"hex"</SPAN>
格式和<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>的历史<SPAN CLASS="QUOTE">"escape"</SPAN>格式。
这两种格式通常在输入中使用，输出格式由<A HREF="runtime-config-client.html#GUC-BYTEA-OUTPUT">bytea_output</A>
配置参数决定，默认是hex。（需要注意的是hex格式是在<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
9.0中引入的，早期版本和一些工具中不识别。） </P><P><ACRONYM CLASS="ACRONYM">SQL</ACRONYM>标准定义了一个不同的二进制字符串格式，称为<TT CLASS="TYPE">BLOB</TT>
或<TT CLASS="TYPE">BINARY LARGE OBJECT</TT>。输入格式与<TT CLASS="TYPE">bytea</TT>不同，
但提供的函数和操作符基本一致。</P><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN5310">8.4.1. <TT CLASS="TYPE">bytea</TT>十六进制格式</A></H2><P><SPAN CLASS="QUOTE">"hex"</SPAN>格式将二进制数据编码为每字节2位十六进制数字，
最重要的四位（半字节）放在开始。整条字符串以<TT CLASS="LITERAL">\x</TT>开始
（与转义格式相区别）。在某些情况下，最初的反斜杠需要再写一次，以转义，
同样，在转义格式中，反斜杠需要写两个，下面会详细介绍。
十六进制数字可以大写也可以小写，并且数字对之间允许有空格（但不能是在一个数对，
也不能是在<TT CLASS="LITERAL">\x</TT>起始序列）。
十六进制格式能够与许多的外部应用程序和协议兼容，并且转换往往比转义快，
因此更倾向于这种用法。 </P><P>例子：
</P><PRE CLASS="PROGRAMLISTING">SELECT E'\\xDEADBEEF';</PRE><P>
</P></DIV><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN5319">8.4.2. <TT CLASS="TYPE">bytea</TT>转义格式</A></H2><P>对于<TT CLASS="TYPE">bytea</TT>格式来说，<SPAN CLASS="QUOTE">"escape"</SPAN>格式是一种传统的
<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>格式。它采用以ASCII字符序列来表示二进制串的方法，
同时将那些无法表示成ASCII字符的二进制串转换成特殊的转义序列。从应用的角度看，
如果代表字节的字符有意义，那么这种表示方法会很方便。但实际上，
这样做会模糊二进制字符串和字符字符串之间的区别，从而造成困扰，
同时筛选出的转义机制会显得很臃肿。因此对一些新应用应该恰当的避免这种格式。 </P><P>当以转义格式录入<TT CLASS="TYPE">bytea</TT>值时，你<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">必须</I></SPAN>转义某些字节值，
同时<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">可以</I></SPAN>转义所有字节值。通常，要转义一个字节值，
将它转换成反斜杠+三位八进制值的形式（或两个反斜杠，如果用转义字符串语法将值写成文本形式）。
另外，反斜杠本身（字节值92）可以用双反斜杠表示。<A HREF="datatype-binary.html#DATATYPE-BINARY-SQLESC">&#34920; 8-7</A>
给出了必须转义的字符串，和替代的转义序列（如适用）。 </P><DIV CLASS="TABLE"><A NAME="DATATYPE-BINARY-SQLESC"></A><P><B>&#34920; 8-7. <TT CLASS="TYPE">bytea</TT>文本转义八进制</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><COL><COL><THEAD><TR><TH>十进制数值</TH><TH>描述</TH><TH>输入转义形式</TH><TH>例子</TH><TH>输出形式</TH></TR></THEAD><TBODY><TR><TD>0</TD><TD>八进制的零</TD><TD><TT CLASS="LITERAL">E'\\000'</TT></TD><TD><TT CLASS="LITERAL">SELECT E'\\000'::bytea;</TT></TD><TD><TT CLASS="LITERAL">\000</TT></TD></TR><TR><TD>39</TD><TD>单引号</TD><TD><TT CLASS="LITERAL">''''</TT> 或 <TT CLASS="LITERAL">E'\\047'</TT></TD><TD><TT CLASS="LITERAL">SELECT E'\''::bytea;</TT></TD><TD><TT CLASS="LITERAL">'</TT></TD></TR><TR><TD>92</TD><TD>反斜杠</TD><TD><TT CLASS="LITERAL">E'\\\\'</TT> 或 <TT CLASS="LITERAL">E'\\134'</TT></TD><TD><TT CLASS="LITERAL">SELECT E'\\\\'::bytea;</TT></TD><TD><TT CLASS="LITERAL">\\</TT></TD></TR><TR><TD>0 to 31 and 127 to 255</TD><TD><SPAN CLASS="QUOTE">"不可打印"</SPAN>八进制字符</TD><TD><TT CLASS="LITERAL">E'\\<TT CLASS="REPLACEABLE"><I>xxx'</I></TT></TT> (八进制值)</TD><TD><TT CLASS="LITERAL">SELECT E'\\001'::bytea;</TT></TD><TD><TT CLASS="LITERAL">\001</TT></TD></TR></TBODY></TABLE></DIV><P>转义<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">不可打印</I></SPAN>字节的要求因区域设置而异。在某些场合下，
你可以不转义它们。请注意<A HREF="datatype-binary.html#DATATYPE-BINARY-SQLESC">&#34920; 8-7</A>
里的每个例子都是刚好一个字节长，虽然输出形式比一个字符要长。</P><P>你必须写这么多反斜杠的原因，如<A HREF="datatype-binary.html#DATATYPE-BINARY-SQLESC">&#34920; 8-7</A>所示，
是因为一个写成字符串文本的输入字符串必须通过<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
服务器里的两个分析阶段。每一对反斜杠中的第一个会被字符串文本分析器理解成一个转义字符而消耗掉，
于是剩下的第二个反斜杠被<TT CLASS="TYPE">bytea</TT>输入函数当作一个三位八进制值或者是转义另外一个反斜杠的开始。
比如，一个传递给服务器的字符串文本<TT CLASS="LITERAL">E'\\001'</TT>在通过字符串分析器之后会当作<TT CLASS="LITERAL">\001</TT>
发送给<TT CLASS="TYPE">bytea</TT>输入函数，在这里它被转换成一个十进制值为 1 的单个字节。请注意，
单引号字符(')不会被<TT CLASS="TYPE">bytea</TT>特殊对待，它遵循字符串文本的普通规则。又见<A HREF="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS">第 4.1.2.1 &#33410;</A>。</P><P><TT CLASS="TYPE">Bytea</TT>字节也在输出中转义。通常，每个<SPAN CLASS="QUOTE">"不可打印"</SPAN>
的字节值都转化成对应的前导反斜杠的三位八进制数值。大多数<SPAN CLASS="QUOTE">"可打印的"</SPAN>
字节值是以客户端字符集的标准表现形式出现的。十进制值为 92(反斜杠)的字节在输出中双写。
细节在<A HREF="datatype-binary.html#DATATYPE-BINARY-RESESC">&#34920; 8-8</A>里描述。</P><DIV CLASS="TABLE"><A NAME="DATATYPE-BINARY-RESESC"></A><P><B>&#34920; 8-8. <TT CLASS="TYPE">bytea</TT>输出转义序列</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><COL><COL><THEAD><TR><TH>字节的十进制值</TH><TH>描述</TH><TH>转义的输出形式</TH><TH>例子</TH><TH>输出结果</TH></TR></THEAD><TBODY><TR><TD>92</TD><TD>反斜杠</TD><TD><TT CLASS="LITERAL">\\</TT></TD><TD><TT CLASS="LITERAL">SELECT E'\\134'::bytea;</TT></TD><TD><TT CLASS="LITERAL">\\</TT></TD></TR><TR><TD>0 to 31 and 127 to 255</TD><TD><SPAN CLASS="QUOTE">"不可打印"</SPAN>八进制字符</TD><TD><TT CLASS="LITERAL">\<TT CLASS="REPLACEABLE"><I>xxx</I></TT></TT> (八进制值)</TD><TD><TT CLASS="LITERAL">SELECT E'\\001'::bytea;</TT></TD><TD><TT CLASS="LITERAL">\001</TT></TD></TR><TR><TD>32 to 126</TD><TD><SPAN CLASS="QUOTE">"可打印"</SPAN>八进制字符</TD><TD>客户端字符集表现形式</TD><TD><TT CLASS="LITERAL">SELECT E'\\176'::bytea;</TT></TD><TD><TT CLASS="LITERAL">~</TT></TD></TR></TBODY></TABLE></DIV><P>根据你使用的前端不同，在是否转义<TT CLASS="TYPE">bytea</TT>字符串的问题上你可能有一些额外的工作要做。
比如，如果你的接口自动转换换行和回车，那你可能还要转义它们。</P></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="datatype-character.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="datatype-datetime.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">字符类型</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/datatype.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">日期/时间类型</TD></TR></TABLE></DIV></BODY></HTML>
