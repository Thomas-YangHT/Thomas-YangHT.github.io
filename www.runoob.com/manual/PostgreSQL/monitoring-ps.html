<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>标准Unix工具</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="监控数据库的活动" HREF="http://school.yunwei.edu/manual/PostgreSQL/monitoring.html"><LINK REL="PREVIOUS" TITLE="监控数据库的活动" HREF="http://school.yunwei.edu/manual/PostgreSQL/monitoring.html"><LINK REL="NEXT" TITLE="统计收集器" HREF="monitoring-stats.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/monitoring.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="监控数据库的活动" HREF="http://school.yunwei.edu/manual/PostgreSQL/monitoring.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/monitoring.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 27. 监控数据库的活动</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="统计收集器" HREF="monitoring-stats.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="MONITORING-PS">27.1. 标准Unix工具</A></H1><P>
<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>在大多数平台上修改<TT CLASS="COMMAND">ps</TT>输出的命令标题，
这样我们就很容易找出某个服务器进程。
一个简单的显示如下：
</P><PRE CLASS="SCREEN">$ ps auxww | grep ^postgres
postgres  15551  0.0  0.1  57536  7132 pts/0    S    18:02   0:00 postgres -i
postgres  15554  0.0  0.0  57536  1184 ?        Ss   18:02   0:00 postgres: writer process
postgres  15555  0.0  0.0  57536   916 ?        Ss   18:02   0:00 postgres: checkpointer process
postgres  15556  0.0  0.0  57536   916 ?        Ss   18:02   0:00 postgres: wal writer process
postgres  15557  0.0  0.0  58504  2244 ?        Ss   18:02   0:00 postgres: autovacuum launcher process
postgres  15558  0.0  0.0  17512  1068 ?        Ss   18:02   0:00 postgres: stats collector process
postgres  15582  0.0  0.0  58772  3080 ?        Ss   18:04   0:00 postgres: joe runbug 127.0.0.1 idle
postgres  15606  0.0  0.0  58772  3052 ?        Ss   18:07   0:00 postgres: tgl regression [local] SELECT waiting
postgres  15610  0.0  0.0  58772  3056 ?        Ss   18:07   0:00 postgres: tgl regression [local] idle in transaction</PRE><P>
调用<TT CLASS="COMMAND">ps</TT>的方法因平台的不同而略有不同，显示出来的细节也有一些区别。
这个例子来自一个最近的Linux系统。这里显示出来的第一个进程是主服务器进程。
显示的命令参数和启动它的命令行参数相同。
下面是由主服务器进程自动调用的五个统计收集器后台进程，
如果你设置了系统不启动统计收集器，那么它们不会出现。
同样的可用禁用<SPAN CLASS="QUOTE">"autovacuum发射器"</SPAN>。
剩下的都是一个个处理客户连接的服务器进程，每个这样的进程都用下面的形式显示：
</P><PRE CLASS="SCREEN">postgres: <TT
CLASS="REPLACEABLE"
><I
>user</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>database</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>host</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>activity</I
></TT
></PRE><P>
在该客户端连接的生命期中，用户，数据库和(客户端)主机都保持不变，
但是活跃性指示符会变化。活跃性可以是<TT CLASS="LITERAL">空闲</TT>(等待客户端的命令)、
<TT CLASS="LITERAL">事务空闲</TT>(在一个<TT CLASS="COMMAND">BEGIN</TT>块里等待用户)、 或者一个命令类型名，比如<TT CLASS="LITERAL">SELECT</TT>。
同样，如果当前正在等待一个其它服务器进程持有的锁的时候，
会在信息后面附加<TT CLASS="LITERAL">waiting</TT>。在上面的例子中，我们可以推出： 进程15606正在等待15610完成其事务，这样才能释放一些锁。进程15610阻塞，
因为没有其他活动会话。在更复杂的情况下，有必要查看
<A HREF="view-pg-locks.html"><TT CLASS="STRUCTNAME">pg_locks</TT></A>
系统视图来决定谁正在阻止他们。
</P><P> 如果关闭了<A HREF="runtime-config-statistics.html#GUC-UPDATE-PROCESS-TITLE">update_process_title</A>那么活跃性指示符将不会变化，
并且进程标题仅在新进程被启动的时候设置一次。 在某些平台上这样做可以节省每个命令的开销，但在其它平台上却没有这种差异。</P><DIV CLASS="TIP"><BLOCKQUOTE CLASS="TIP"><P><B>&#25552;&#31034;: </B>
<SPAN CLASS="PRODUCTNAME">Solaris</SPAN>需要特别的处理。
你必需使用<TT CLASS="COMMAND">/usr/ucb/ps</TT>而不是<TT CLASS="COMMAND">/bin/ps</TT>。
你还必需使用两个<TT CLASS="OPTION">w</TT>标志，而不是一个。
另外，你最初调用<TT CLASS="COMMAND">postgres</TT>时
用到的命令行在<TT CLASS="COMMAND">ps</TT>状态显示中必须比
每个服务器进程显示的短。如果没满足这三个条件，
那么<TT CLASS="COMMAND">ps</TT>为每个服务器进程输出的将是最初的<TT CLASS="COMMAND">postgres</TT>的命令行。</P></BLOCKQUOTE></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/monitoring.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="monitoring-stats.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">监控数据库的活动</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/monitoring.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">统计收集器</TD></TR></TABLE></DIV></BODY></HTML>
