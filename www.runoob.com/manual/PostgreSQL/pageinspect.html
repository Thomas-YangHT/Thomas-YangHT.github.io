<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>pageinspect</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="额外提供的模块" HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html"><LINK REL="PREVIOUS" TITLE="ltree" HREF="ltree.html"><LINK REL="NEXT" TITLE="passwordcheck" HREF="passwordcheck.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/pageinspect.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="ltree" HREF="ltree.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#38468;&#24405; F. 额外提供的模块</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="passwordcheck" HREF="passwordcheck.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="PAGEINSPECT">F.22. pageinspect</A></H1><P><TT CLASS="FILENAME">pageinspect</TT>模块提供了允许在低层次检查数据库页面内容的函数，
这对于调试目的很有用。所有这些函数只能由超级用户使用。</P><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN147837">F.22.1. 函数</A></H2><P></P><DIV CLASS="VARIABLELIST"><DL><DT><CODE CLASS="FUNCTION">get_raw_page(relname text, fork text, blkno int) returns bytea</CODE></DT><DD><P><CODE CLASS="FUNCTION">get_raw_page</CODE>读取命名表指定的块并返回一个拷贝作为<TT CLASS="TYPE">bytea</TT>值。
这允许获得一个该块的时间一致的拷贝。<TT CLASS="REPLACEABLE"><I>fork</I></TT>应该是主数据分支的
<TT CLASS="LITERAL">'main'</TT>，或自由空间映射的<TT CLASS="LITERAL">'fsm'</TT>，或可见映射的<TT CLASS="LITERAL">'vm'</TT>。</P></DD><DT><CODE CLASS="FUNCTION">get_raw_page(relname text, blkno int) returns bytea</CODE></DT><DD><P><CODE CLASS="FUNCTION">get_raw_page</CODE>的短版本，从主分支上读取。
等于<TT CLASS="LITERAL">get_raw_page(relname, 'main', blkno)</TT></P></DD><DT><CODE CLASS="FUNCTION">page_header(page bytea) returns record</CODE></DT><DD><P><CODE CLASS="FUNCTION">page_header</CODE>显示了所有<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
堆和索引页共通的字段。</P><P><CODE CLASS="FUNCTION">get_raw_page</CODE>获得的页面镜像应该作为一个参数传送。例如：
</P><PRE CLASS="SCREEN">test=# SELECT * FROM page_header(get_raw_page('pg_class', 0));
    lsn    | checksum | flags  | lower | upper | special | pagesize | version | prune_xid
-----------+----------+--------+-------+-------+---------+----------+---------+-----------
 0/24A1B50 |        1 |      1 |   232 |   368 |    8192 |     8192 |       4 |         0</PRE><P>
返回的列符合<TT CLASS="STRUCTNAME">PageHeaderData</TT>结构中的字段。
参阅<TT CLASS="FILENAME">src/include/storage/bufpage.h</TT>获取详细信息。
</P></DD><DT><CODE CLASS="FUNCTION">heap_page_items(page bytea) returns setof record</CODE></DT><DD><P><CODE CLASS="FUNCTION">heap_page_items</CODE>显示了一个堆页面中所有的行指针。
对于那些还在使用中的行指针，也显示元组头。所有的元组都被显示，
不管在拷贝裸页面时这些元组对MVCC快照是否可见。</P><P><CODE CLASS="FUNCTION">get_raw_page</CODE>获得的堆页面镜像应该作为一个参数传递。例如：
</P><PRE CLASS="SCREEN">test=# SELECT * FROM heap_page_items(get_raw_page('pg_class', 0));</PRE><P>
参阅<TT CLASS="FILENAME">src/include/storage/itemid.h</TT>和<TT CLASS="FILENAME">src/include/access/htup_details.h</TT>
获取返回的字段的解释。</P></DD><DT><CODE CLASS="FUNCTION">bt_metap(relname text) returns record</CODE></DT><DD><P>
<CODE CLASS="FUNCTION">bt_metap</CODE>返回关于B-tree索引的元数据页的信息。例如：
</P><PRE CLASS="SCREEN">test=# SELECT * FROM bt_metap('pg_cast_oid_index');
-[ RECORD 1 ]-----
magic     | 340322
version   | 2
root      | 1
level     | 0
fastroot  | 1
fastlevel | 0</PRE><P>
</P></DD><DT><CODE CLASS="FUNCTION">bt_page_stats(relname text, blkno int) returns record</CODE></DT><DD><P>
<CODE CLASS="FUNCTION">bt_page_stats</CODE>返回关于B-tree索引的单个页面的摘要信息。例如：
</P><PRE CLASS="SCREEN">test=# SELECT * FROM bt_page_stats('pg_cast_oid_index', 1);
-[ RECORD 1 ]-+-----
blkno         | 1
type          | l
live_items    | 256
dead_items    | 0
avg_item_size | 12
page_size     | 8192
free_size     | 4056
btpo_prev     | 0
btpo_next     | 0
btpo          | 0
btpo_flags    | 3</PRE><P>
</P></DD><DT><CODE CLASS="FUNCTION">bt_page_items(relname text, blkno int) returns setof record</CODE></DT><DD><P>
<CODE CLASS="FUNCTION">bt_page_items</CODE>返回关于B-tree索引页中的所有条目的详细信息。例如：
</P><PRE CLASS="SCREEN">test=# SELECT * FROM bt_page_items('pg_cast_oid_index', 1);
 itemoffset |  ctid   | itemlen | nulls | vars |    data
------------+---------+---------+-------+------+-------------
          1 | (0,1)   |      12 | f     | f    | 23 27 00 00
          2 | (0,2)   |      12 | f     | f    | 24 27 00 00
          3 | (0,3)   |      12 | f     | f    | 25 27 00 00
          4 | (0,4)   |      12 | f     | f    | 26 27 00 00
          5 | (0,5)   |      12 | f     | f    | 27 27 00 00
          6 | (0,6)   |      12 | f     | f    | 28 27 00 00
          7 | (0,7)   |      12 | f     | f    | 29 27 00 00
          8 | (0,8)   |      12 | f     | f    | 2a 27 00 00</PRE><P>
</P></DD><DT><CODE CLASS="FUNCTION">fsm_page_contents(page bytea) returns text</CODE></DT><DD><P><CODE CLASS="FUNCTION">fsm_page_contents</CODE>显示了FSM页的内部节点结构。输出是多行字符串，
在该页中的二叉树上每个节点一行。这些节点中只有不是零的才输出。也输出被称为"next"的指针，
这个指针指向下一个从页面中返回的位置。</P><P>参阅<TT CLASS="FILENAME">src/backend/storage/freespace/README</TT>获取更多关于FSM页面的结构的信息。</P></DD></DL></DIV></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="ltree.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="passwordcheck.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">ltree</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">passwordcheck</TD></TR></TABLE></DIV></BODY></HTML>
