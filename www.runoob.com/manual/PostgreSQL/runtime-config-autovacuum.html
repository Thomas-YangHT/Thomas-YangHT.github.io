<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>自动清理</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="服务器配置" HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime-config.html"><LINK REL="PREVIOUS" TITLE="运行时统计" HREF="runtime-config-statistics.html"><LINK REL="NEXT" TITLE="客户端连接缺省" HREF="runtime-config-client.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/config.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="运行时统计" HREF="runtime-config-statistics.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime-config.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 18. 服务器配置</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="客户端连接缺省" HREF="runtime-config-client.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="RUNTIME-CONFIG-AUTOVACUUM">18.10. 自动清理</A></H1><P> 这些设置控制<I CLASS="FIRSTTERM">自动清理</I>的缺省行为。请参阅<A HREF="routine-vacuuming.html#AUTOVACUUM">第 23.1.6 &#33410;</A>获取更多信息。</P><P></P><DIV CLASS="VARIABLELIST"><DL><DT><A NAME="GUC-AUTOVACUUM"></A><TT CLASS="VARNAME">autovacuum</TT> (<TT CLASS="TYPE">boolean</TT>)</DT><DD><P> 控制服务器是否应该启动autovacuum守护进程。缺省是关闭的。然而，
<A HREF="runtime-config-statistics.html#GUC-TRACK-COUNTS">track_counts</A>还必须启用自动清理工作。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者是服务器命令行中设置。</P><P> 请注意，即使禁用该参数，如果有必要避免事务ID重叠，系统仍将启动自动清理进程。
请参阅<A HREF="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND">第 23.1.5 &#33410;</A>获取更多详细信息。</P></DD><DT><A NAME="GUC-LOG-AUTOVACUUM-MIN-DURATION"></A><TT CLASS="VARNAME">log_autovacuum_min_duration</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 如果它运行至少毫秒指定数，导致记录自动清理所执行的每个动作。
此设置为零记录所有自动清理操作。减一（默认）禁用日志记录
自动清理动作。例如，如果您将其设置为<TT CLASS="LITERAL">250ms</TT>，
那么将记录运行250ms或更长时间的所有自动清理和分析。
此外，当这个参数设置为除<TT CLASS="LITERAL">-1</TT>外的其他任何值，
如果由于冲突锁的存在而忽略自动清理操作，则记录这条消息。
启用此参数可以有益于跟踪自动清理活动。这个设置只能在<TT CLASS="FILENAME">postgresql.conf</TT>
文件或者服务器命令行上设置。</P></DD><DT><A NAME="GUC-AUTOVACUUM-MAX-WORKERS"></A><TT CLASS="VARNAME">autovacuum_max_workers</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 指定自动清理进程的最大数（除了自动清理发射器），它可以在任一时刻运行。
默认是三。这个参数只能在服务器启动时设置。</P></DD><DT><A NAME="GUC-AUTOVACUUM-NAPTIME"></A><TT CLASS="VARNAME">autovacuum_naptime</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 声明运行在任何给定数据库上的autovacuum之间的最小延迟。在每次运行的周期里，
守护进程都会检查一个数据库，
并根据需要为该数据库的表发出<TT CLASS="COMMAND">VACUUM</TT>和<TT CLASS="COMMAND">ANALYZE</TT>命令。
这个延迟是以秒计的，缺省为1分钟(<TT CLASS="LITERAL">1min</TT>)。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者服务器命令行中设置。</P></DD><DT><A NAME="GUC-AUTOVACUUM-VACUUM-THRESHOLD"></A><TT CLASS="VARNAME">autovacuum_vacuum_threshold</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 声明在任何表里触发<TT CLASS="COMMAND">VACUUM</TT>所需最小的行更新或删除数量。缺省是500。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者服务器命令行中设置。
此处的设置可以被改变存储参数的独立的表覆盖。</P></DD><DT><A NAME="GUC-AUTOVACUUM-ANALYZE-THRESHOLD"></A><TT CLASS="VARNAME">autovacuum_analyze_threshold</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 声明在任何表里触发<TT CLASS="COMMAND">ANALYZE</TT>所需最小的行插入、更新、删除数量。缺省是50。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者服务器命令行中设置。
此处的设置可以被改变存储参数的独立表覆盖。</P></DD><DT><A NAME="GUC-AUTOVACUUM-VACUUM-SCALE-FACTOR"></A><TT CLASS="VARNAME">autovacuum_vacuum_scale_factor</TT> (<TT CLASS="TYPE">floating point</TT>)</DT><DD><P> 声明在判断是否触发一个<TT CLASS="COMMAND">VACUUM</TT>时增加到<TT CLASS="VARNAME">autovacuum_vacuum_threshold</TT>
参数里面的表尺寸的分数。
缺省是0.2(表大小的20%)。这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者服务器命令行中设置。
此处的设置可以被改变存储参数的独立表覆盖。 </P></DD><DT><A NAME="GUC-AUTOVACUUM-ANALYZE-SCALE-FACTOR"></A><TT CLASS="VARNAME">autovacuum_analyze_scale_factor</TT> (<TT CLASS="TYPE">floating point</TT>)</DT><DD><P> 声明在判断是否触发一个<TT CLASS="COMMAND">ANALYZE</TT>时增加到<TT CLASS="VARNAME">autovacuum_analyze_threshold</TT>
参数里面的表尺寸的分数。缺省是0.1(表大小的10%)。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者服务器启动的时候设置。
此处的设置可以被改变存储参数的独立表覆盖。</P></DD><DT><A NAME="GUC-AUTOVACUUM-FREEZE-MAX-AGE"></A><TT CLASS="VARNAME">autovacuum_freeze_max_age</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 指定表的<TT CLASS="STRUCTNAME">pg_class</TT>在事务中的最大寿命。<TT CLASS="STRUCTFIELD">relfrozenxid</TT>字段能够在强制
<TT CLASS="COMMAND">VACUUM</TT>操作以防止事务
ID在表内循环重复之前完成。需要注意的是，即使autovacuum被禁止系统也会调用
autovacuum 进程来防止循环重复。
</P><P> 自动清理允许删除来自<TT CLASS="FILENAME">pg_clog</TT>子目录的旧文件，
默认值是相对低于200百万事务。该参数只能在服务器启动时设置，
但是此处的设置可以通过改变存储参数独立表减少。
更多信息请参见<A HREF="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND">第 23.1.5 &#33410;</A>。&#13;</P></DD><DT><A NAME="GUC-AUTOVACUUM-VACUUM-COST-DELAY"></A><TT CLASS="VARNAME">autovacuum_vacuum_cost_delay</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 声明将在自动<TT CLASS="COMMAND">VACUUM</TT>操作里使用的开销延迟数值。
声明-1将使用普通的<A HREF="runtime-config-resource.html#GUC-VACUUM-COST-DELAY">vacuum_cost_delay</A>数值。
缺省值是20毫秒。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者在服务器启动的时候设置。
此处的设置可以被改变存储参数的独立表覆盖。</P></DD><DT><A NAME="GUC-AUTOVACUUM-VACUUM-COST-LIMIT"></A><TT CLASS="VARNAME">autovacuum_vacuum_cost_limit</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 声明将在自动<TT CLASS="COMMAND">VACUUM</TT>操作里使用的开销限制数值。
-1(缺省值)将使用普通的<A HREF="runtime-config-resource.html#GUC-VACUUM-COST-LIMIT">vacuum_cost_limit</A>数值。
要注意的是值将按比例分配给运行autovacuum工作者，
如果有一个以上，这样每个工作者限制总和不会超过此变量的极限。
这个选项只能在<TT CLASS="FILENAME">postgresql.conf</TT>文件里或者在服务器启动的时候设置。
此处的设置可以通过改变存储参数独立表覆盖。</P></DD></DL></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="runtime-config-statistics.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="runtime-config-client.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">运行时统计</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime-config.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">客户端连接缺省</TD></TR></TABLE></DIV></BODY></HTML>
