<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>tsearch2</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="额外提供的模块" HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html"><LINK REL="PREVIOUS" TITLE="test_parser" HREF="test-parser.html"><LINK REL="NEXT" TITLE="unaccent" HREF="unaccent.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/tsearch2.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="test_parser" HREF="test-parser.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#38468;&#24405; F. 额外提供的模块</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="unaccent" HREF="unaccent.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="TSEARCH2">F.39. tsearch2</A></H1><P><SPAN CLASS="APPLICATION">tsearch2</SPAN>模块为在文本搜索整合到内核<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
版本8.3之前的应用提供后向兼容的文本搜索功能。
</P><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN150703">F.39.1. 可移植性问题</A></H2><P>尽管内建的文本搜索功能基于<SPAN CLASS="APPLICATION">tsearch2</SPAN>并且在很大程度上相似，
但是有许多微小的差异将造成现有应用的可移植性问题：
</P><P></P><UL><LI STYLE="list-style-type: disc"><P> 一些函数的名字改变了，例如<CODE CLASS="FUNCTION">rank</CODE>变成了<CODE CLASS="FUNCTION">ts_rank</CODE>。
替换的<TT CLASS="LITERAL">tsearch2</TT>模块提供了具有旧名称的别名。
</P></LI><LI STYLE="list-style-type: disc"><P> 内建文本搜索数据类型和函数都存在于系统模式<TT CLASS="LITERAL">pg_catalog</TT>中。
在一个安装中使用<SPAN CLASS="APPLICATION">tsearch2</SPAN>，这些对象将通常存在于<TT CLASS="LITERAL">public</TT>模式中，
尽管一些用户选择在他们自己的模式中放置它们。引用这些对象的明确模式限定将因此会在两种情况下失败。
替换的<TT CLASS="LITERAL">tsearch2</TT>模块提供了存储在<TT CLASS="LITERAL">public</TT>（或者是另一个模式，如果需要）
中的别名对象，所以这样的引用仍然工作。
</P></LI><LI STYLE="list-style-type: disc"><P> 在内建文本搜索功能中没有<SPAN CLASS="QUOTE">"当前分析器"</SPAN>或<SPAN CLASS="QUOTE">"当前字典"</SPAN>的概念，
只有一个当前搜索配置（通过<TT CLASS="VARNAME">default_text_search_config</TT>参数设置）的概念。
当当前分析器和当前字典只被调试函数使用时，可能在某些情况下仍然会造成移植的障碍。
替换的<TT CLASS="LITERAL">tsearch2</TT>模块仿真这些额外的状态变量，
并为设置和检索它们提供后向兼容函数。
</P></LI></UL><P> 有一些问题没有被替换的<TT CLASS="LITERAL">tsearch2</TT>模块处理，
并且因此将在任意情况下请求改变应用代码：
</P><P></P><UL><LI STYLE="list-style-type: disc"><P>旧的<CODE CLASS="FUNCTION">tsearch2</CODE>触发器函数允许参数列表中的项在转换成<TT CLASS="TYPE">tsvector</TT>
格式之前，成为在文本数据中被调用的函数的名字。因为这是一个安全漏洞所以被删除了，
因此不可能保证调用的函数是想要的那一个。如果数据在被索引之前必须被处理，
那么推荐的方式是写一个为其本身工作的自定义触发器。</P></LI><LI STYLE="list-style-type: disc"><P> 文本搜索配置信息移动到了内核系统目录，明显不同于用于<SPAN CLASS="APPLICATION">tsearch2</SPAN>的表。
任何检查或修改这些表的应用将需要调整。
</P></LI><LI STYLE="list-style-type: disc"><P>如果一个应用使用了任何自定义文本搜索配置，他们将需要使用新的文本搜索配置SQL命令在内核目录中设置。
替换的<TT CLASS="LITERAL">tsearch2</TT>模块为此提供了一点支持，通过让加载一组老的<SPAN CLASS="APPLICATION">tsearch2</SPAN>
配置表到<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN> 8.3中成为可能。（没有这个模块，
不可能加载配置数据，因为<TT CLASS="TYPE">regprocedure</TT>字段中的值不能解析为函数。）
虽然这些配置表不能实际<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">做</I></SPAN>任何事情，
至少它们的内容在8.3中设置一个相等的自定义配置时可用于咨询。
</P></LI><LI STYLE="list-style-type: disc"><P> 不支持旧的<CODE CLASS="FUNCTION">reset_tsearch()</CODE>和<CODE CLASS="FUNCTION">get_covers()</CODE>函数。
</P></LI><LI STYLE="list-style-type: disc"><P> 替换的<TT CLASS="LITERAL">tsearch2</TT>模块没有定义任何别名运算符，
完全依赖于内建的那个。这只在一个应用使用明确模式限定的操作符名时造成问题，
这是非常罕见的。
</P></LI></UL></DIV><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN150750">F.39.2. 转换一个8.3之前的安装</A></H2><P> 更新使用<SPAN CLASS="APPLICATION">tsearch2</SPAN>的8.3之前的安装的推荐方式是：
</P><DIV CLASS="PROCEDURE"><OL TYPE="1"><LI CLASS="STEP"><P> 以普通的方式从老的安装中做一个转储，但是确保不要使用<SPAN CLASS="APPLICATION">pg_dump</SPAN>
或<SPAN CLASS="APPLICATION">pg_dumpall</SPAN>的<TT CLASS="LITERAL">-c</TT> (<TT CLASS="LITERAL">--clean</TT>)选项。
</P></LI><LI CLASS="STEP"><P> 在新的安装中，创建空的数据库并安装替换的<TT CLASS="LITERAL">tsearch2</TT>
模块到每个将要使用文本搜索的数据库。这必须在加载转储数据<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">之前</I></SPAN>完成！
如果你的旧安装在除了<TT CLASS="LITERAL">public</TT>之外的一个模式中有<SPAN CLASS="APPLICATION">tsearch2</SPAN>对象，
确保调整<TT CLASS="COMMAND">CREATE EXTENSION</TT>命令，这样替换的对象在相同的模式中创建。
</P></LI><LI CLASS="STEP"><P> 加载转储数据。将会报告一些错误，因为未能重新创建原来的<SPAN CLASS="APPLICATION">tsearch2</SPAN>对象。
可以忽略这些错误，但是这意味着你不能在单个事务中恢复转储
（例如，你不能使用<SPAN CLASS="APPLICATION">pg_restore</SPAN>的<TT CLASS="OPTION">-1</TT>开关）。
</P></LI><LI CLASS="STEP"><P> 检查恢复的<SPAN CLASS="APPLICATION">tsearch2</SPAN>配置表的内容（<TT CLASS="STRUCTNAME">pg_ts_cfg</TT>等），
并根据需要创建相等的内建文本搜索配置。你可能会在提取了所有有用的信息之后删除旧的配置表。
</P></LI><LI CLASS="STEP"><P>
测试你的应用。
</P></LI></OL></DIV><P> 稍后你可能希望重命名应用引用到别名文本搜索对象，
这样你可以最后卸载替换的<TT CLASS="LITERAL">tsearch2</TT>模块。
</P></DIV><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN150781">F.39.3. 参考文献</A></H2><P> Tsearch2 开发网站
<A HREF="http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/" TARGET="_top">http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/</A>
</P></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="test-parser.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="unaccent.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">test_parser</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">unaccent</TD></TR></TABLE></DIV></BODY></HTML>
