<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>模板数据库</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="管理数据库" HREF="http://school.yunwei.edu/manual/PostgreSQL/managing-databases.html"><LINK REL="PREVIOUS" TITLE="创建一个数据库" HREF="manage-ag-createdb.html"><LINK REL="NEXT" TITLE="数据库配置" HREF="manage-ag-config.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/manage-ag.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="创建一个数据库" HREF="manage-ag-createdb.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/managing-databases.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 21. 管理数据库</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="数据库配置" HREF="manage-ag-config.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="MANAGE-AG-TEMPLATEDBS">21.3. 模板数据库</A></H1><P><TT CLASS="COMMAND">CREATE DATABASE</TT>实际上是通过拷贝一个现有的数据库进行工作的。缺省时，
它拷贝名为<TT CLASS="LITERAL">template1</TT>的标准系统数据库。
所以该数据库是创建新数据库的<SPAN CLASS="QUOTE">"模板"</SPAN>。如果你给<TT CLASS="LITERAL">template1</TT>增加对象，
这些对象将被拷贝到随后创建的用户数据库中。这样的行为允许节点对数据库中的标准套件进行修改。
比如，如果你把过程语言<SPAN CLASS="APPLICATION">PL/Perl</SPAN>安装到<TT CLASS="LITERAL">template1</TT>里，
那么你在创建用户数据库的时候它们就会自动可得，而不需要额外的动作。</P><P>系统里还有名为<TT CLASS="LITERAL">template0</TT>的第二个标准系统数据库，
这个数据库包含和<TT CLASS="LITERAL">template1</TT>初始时一样的数据内容，也就是说，
只包含标准的<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>对象。在数据库集群初始化之后，
我们不应该对<TT CLASS="LITERAL">template0</TT>做任何修改。通过告诉<TT CLASS="COMMAND">CREATE DATABASE</TT>使用
<TT CLASS="LITERAL">template0</TT>而不是<TT CLASS="LITERAL">template1</TT>进行拷贝，你可以创建一个<SPAN CLASS="QUOTE">"纯净"</SPAN>
的用户数据库，它不会包含任何<TT CLASS="LITERAL">template1</TT>里所特有的东西。
这一点在恢复<TT CLASS="LITERAL">pg_dump</TT>转储的时候是非常方便的：
转储脚本应该在一个纯净的数据库中恢复以确保我们正确创建了被转储出的数据库内容，
而不会随后和可能已经添加到<TT CLASS="LITERAL">template1</TT>中的对象相冲突。</P><P>拷贝<TT CLASS="LITERAL">template0</TT>而不是<TT CLASS="LITERAL">template1</TT>的另一个常见原因是在拷贝
<TT CLASS="LITERAL">template0</TT>时，可以指定新的编码和本地设置，而拷贝<TT CLASS="LITERAL">template1</TT>
时必须使用和<TT CLASS="LITERAL">template1</TT>相同的设置。这是因为<TT CLASS="LITERAL">template1</TT>
可能包含编码指定或本地指定的数据，而<TT CLASS="LITERAL">template0</TT>不这样。</P><P>要通过拷贝<TT CLASS="LITERAL">template0</TT>的方法创建一个数据库，可使用：
</P><PRE CLASS="PROGRAMLISTING">CREATE DATABASE <TT
CLASS="REPLACEABLE"
><I
>dbname</I
></TT
> TEMPLATE template0;</PRE><P>
用于 SQL 环境，或：
</P><PRE CLASS="PROGRAMLISTING">createdb -T template0 <TT
CLASS="REPLACEABLE"
><I
>dbname</I
></TT
></PRE><P>
用于 shell 环境。
</P><P>我们可以创建额外的模板数据库，而且实际上我们可以在一个集群中通过将
<TT CLASS="COMMAND">CREATE DATABASE</TT>的模板声明为相应的数据库名拷贝任何数据库。不过，
我们必需明白，这个功能并非一般性的<SPAN CLASS="QUOTE">"<TT CLASS="COMMAND">COPY DATABASE</TT>"</SPAN>工具。
实际上，在拷贝操作的过程中，源数据库必需是空闲状态(没有正在处理的数据修改事务)。
如果在<TT CLASS="COMMAND">CREATE DATABASE</TT>开始的时候存在其它连接，那么操作将会失败，
在拷贝期间，到源数据库的新连接都被阻止。</P><P>在<TT CLASS="LITERAL">pg_database</TT>里有两个有用的标志可以用于每个数据库：
<TT CLASS="LITERAL">datistemplate</TT>和<TT CLASS="LITERAL">datallowconn</TT>字段。<TT CLASS="LITERAL">datistemplate</TT>
表示该数据库是准备用作<TT CLASS="COMMAND">CREATE DATABASE</TT>模板的。如果设置了这个标志，
那么该数据库可以由任何有<TT CLASS="LITERAL">CREATEDB</TT>权限的用户克隆；如果没有设置，
那么只有超级用户和该数据库的所有者可以克隆它。如果<TT CLASS="LITERAL">datallowconn</TT>为假，
那么将不允许与该数据库发生任何新的连接(不过现有的会话不会因为把该标志设置为假而终止)。
<TT CLASS="LITERAL">template0</TT>数据库通常被标记为<TT CLASS="LITERAL">datallowconn = false</TT>以避免对它的修改。
<TT CLASS="LITERAL">template0</TT>和<TT CLASS="LITERAL">template1</TT>都应该总是标记为<TT CLASS="LITERAL">datistemplate = true</TT>。</P><DIV CLASS="NOTE"><BLOCKQUOTE CLASS="NOTE"><P><B>&#27880;&#24847;: </B><TT CLASS="LITERAL">template1</TT>和<TT CLASS="LITERAL">template0</TT>没有任何特殊的状态，
除了<TT CLASS="LITERAL">template1</TT>是<TT CLASS="COMMAND">CREATE DATABASE</TT>的缺省源数据库名之外。比如，
我们可以删除<TT CLASS="LITERAL">template1</TT>然后从<TT CLASS="LITERAL">template0</TT>中创建它而不会有任何不良效果。
如果我们不小心在<TT CLASS="LITERAL">template1</TT>里加了一堆垃圾，那么我们就会建议做这样的操作。
（要删除<TT CLASS="LITERAL">template1</TT>，必须使<TT CLASS="LITERAL">pg_database.datistemplate = false</TT>。）</P><P>在初始化数据库集群的时候，也会创建<TT CLASS="LITERAL">postgres</TT>数据库。
这个数据库用于做为用户和应用连接的缺省数据库。它只是<TT CLASS="LITERAL">template1</TT>的一个简单拷贝，
需要的时候可以删除或者重建。</P></BLOCKQUOTE></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="manage-ag-createdb.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="manage-ag-config.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">创建一个数据库</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/managing-databases.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">数据库配置</TD></TR></TABLE></DIV></BODY></HTML>
