<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>锁管理</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="服务器配置" HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime-config.html"><LINK REL="PREVIOUS" TITLE="客户端连接缺省" HREF="runtime-config-client.html"><LINK REL="NEXT" TITLE="版本和平台兼容性" HREF="runtime-config-compatible.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/config.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="客户端连接缺省" HREF="runtime-config-client.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime-config.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#31456; 18. 服务器配置</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="版本和平台兼容性" HREF="runtime-config-compatible.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="RUNTIME-CONFIG-LOCKS">18.12. 锁管理</A></H1><P></P><DIV CLASS="VARIABLELIST"><DL><DT><A NAME="GUC-DEADLOCK-TIMEOUT"></A><TT CLASS="VARNAME">deadlock_timeout</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 以毫秒计的时间，用于设置在检查是否存在死锁条件之前等待的时间。
检查是否存在死锁条件是一个昂贵的过程，因此服务器不会在每次等待锁的时候都运行这个过程。
我们乐观地假设在生产应用中的死锁是不常出现的，
因此我们在开始询问是否可以解锁之前只等待一个相对较短的时间。
增加这个值就减少了浪费在无用的死锁检查上的时间，但是减慢了报告真正死锁错误的速度。
缺省是1秒(<TT CLASS="LITERAL">1s</TT>)，这可能是你能够耐心等待的最短时间。在一个重负载的服务器上，
你可能需要增大它。这个值的典型设置应该超过你的事务持续时间，
这样就可以减少在锁释放之前就开始死锁检查的问题。
只有超级用户可以改变这个设置。</P><P> 当<A HREF="runtime-config-logging.html#GUC-LOG-LOCK-WAITS">log_lock_waits</A>被设置时，
此参数也决定在发出有关锁等待的日志信息之前的等待时间长度。
如果您正在尝试调查锁定延迟，
你可能想设置一个小于正常<TT CLASS="VARNAME">deadlock_timeout</TT>的值。</P></DD><DT><A NAME="GUC-MAX-LOCKS-PER-TRANSACTION"></A><TT CLASS="VARNAME">max_locks_per_transaction</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 共享的锁表的大小是以假设任意时刻最多只有
<TT CLASS="VARNAME">max_locks_per_transaction</TT> * (<A HREF="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</A> + <A HREF="runtime-config-resource.html#GUC-MAX-PREPARED-TRANSACTIONS">max_prepared_transactions</A>)
个独立的对象需要被锁住为基础进行计算的。
这个参数控制分配给每个事务的锁定对象平均数。
单独事务只要所有事务锁适合在锁表中都可以锁定多个对象。
这<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">不是</I></SPAN>锁定行的数目，
该值是无限的。缺省值64，已经经历史证明是足够的了，
不过如果你有在一个事务里接触很多不同的表的查询，那么你就可能需要提高这个数值。
比如带有很多孩子的父表查询。
这个值只能在服务器启动的时候设置。</P><P> 当运行备用服务器时，你必须将此参数设置为比主服务器上相同或更高的值。否则，
不允许在备用服务器进行查询。</P></DD><DT><A NAME="GUC-MAX-PRED-LOCKS-PER-TRANSACTION"></A><TT CLASS="VARNAME">max_pred_locks_per_transaction</TT> (<TT CLASS="TYPE">integer</TT>)</DT><DD><P> 共享谓词锁表跟踪锁定在
<TT CLASS="VARNAME">max_pred_locks_per_transaction</TT> * (<A HREF="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</A> + <A HREF="runtime-config-resource.html#GUC-MAX-PREPARED-TRANSACTIONS">max_prepared_transactions</A>)对象上（例如，表）;
因此，只是许多不同的对象更可以在任何一个时间锁定。
此参数控制对象锁定分配给每个事务的平均数;
个别事务可以锁定多个对象，
只要所有事务的锁适合在锁表中。这<SPAN CLASS="emphasis"><I CLASS="EMPHASIS">不是</I></SPAN>
可以锁定的行数;该值是无限的。
在默认情况下，64对测试已经足够了，
如果在可串行化事务中你有接触许多不同表的客户，那么您可能需要增大这个值。
此参数只能在服务器启动时设置。</P></DD></DL></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="runtime-config-client.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="runtime-config-compatible.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">客户端连接缺省</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/runtime-config.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">版本和平台兼容性</TD></TR></TABLE></DIV></BODY></HTML>
