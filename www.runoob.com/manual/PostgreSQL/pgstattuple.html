<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>pgstattuple</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="额外提供的模块" HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html"><LINK REL="PREVIOUS" TITLE="pg_stat_statements" HREF="pgstatstatements.html"><LINK REL="NEXT" TITLE="pg_trgm" HREF="pgtrgm.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="SECT1">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/pgstattuple.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="pg_stat_statements" HREF="pgstatstatements.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom">&#38468;&#24405; F. 额外提供的模块</TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="pg_trgm" HREF="pgtrgm.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><DIV CLASS="SECT1"><H1 CLASS="SECT1"><A NAME="PGSTATTUPLE">F.29. pgstattuple</A></H1><P><TT CLASS="FILENAME">pgstattuple</TT>模块提供各种函数以获得元组级别的状态。</P><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN149170">F.29.1. 函数</A></H2><P></P><DIV CLASS="VARIABLELIST"><DL><DT><CODE CLASS="FUNCTION">pgstattuple(text) returns record</CODE></DT><DD><P>
<CODE CLASS="FUNCTION">pgstattuple</CODE>返回一个关系的实际长度，<SPAN CLASS="QUOTE">"死的"</SPAN>
元组的百分比，和其他信息。这帮助用户确定是否需要vacuum。
该参数是目标关系的名字（可以有模式限定）。例如：
</P><PRE CLASS="PROGRAMLISTING">test=&#62; SELECT * FROM pgstattuple('pg_catalog.pg_proc');
-[ RECORD 1 ]------+-------
table_len          | 458752
tuple_count        | 1470
tuple_len          | 438896
tuple_percent      | 95.67
dead_tuple_count   | 11
dead_tuple_len     | 3157
dead_tuple_percent | 0.69
free_space         | 8932
free_percent       | 1.95</PRE><P>
输出字段在<A HREF="pgstattuple.html#PGSTATTUPLE-COLUMNS">&#34920; F-21</A>中描述。
</P><DIV CLASS="TABLE"><A NAME="PGSTATTUPLE-COLUMNS"></A><P><B>&#34920; F-21. <CODE CLASS="FUNCTION">pgstattuple</CODE> 输出字段</B></P><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><THEAD><TR><TH>字段</TH><TH>类型</TH><TH>描述</TH></TR></THEAD><TBODY><TR><TD><TT CLASS="STRUCTFIELD">table_len</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>实际关系长度以字节计</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">tuple_count</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>活的元组的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">tuple_len</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>活的元组的总长度，以字节计</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">tuple_percent</TT></TD><TD><TT CLASS="TYPE">float8</TT></TD><TD>活的元组的百分比</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">dead_tuple_count</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>死的元组的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">dead_tuple_len</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>死的元组的总长度，以字节计</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">dead_tuple_percent</TT></TD><TD><TT CLASS="TYPE">float8</TT></TD><TD>死的元组的百分比</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">free_space</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>总的空闲空间，以字节计</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">free_percent</TT></TD><TD><TT CLASS="TYPE">float8</TT></TD><TD>空闲空间的百分比</TD></TR></TBODY></TABLE></DIV><P><CODE CLASS="FUNCTION">pgstattuple</CODE>只获取关系中的读锁。所以结果并不反映一个瞬间的快照；
并发的更新将影响它们。</P><P>如果<CODE CLASS="FUNCTION">HeapTupleSatisfiesNow</CODE>返回假，那么<CODE CLASS="FUNCTION">pgstattuple</CODE>
判断一个元组是否是<SPAN CLASS="QUOTE">"死的"</SPAN>。</P></DD><DT><CODE CLASS="FUNCTION">pgstattuple(oid) returns record</CODE></DT><DD><P>这和<CODE CLASS="FUNCTION">pgstattuple(text)</CODE>一样，除了目标关系是通过OID指定之外。</P></DD><DT>&#13; <CODE CLASS="FUNCTION">pgstatindex(text) returns record</CODE></DT><DD><P>
<CODE CLASS="FUNCTION">pgstatindex</CODE>返回一个显示关于B-tree索引信息的记录。例如：
</P><PRE CLASS="PROGRAMLISTING">test=&#62; SELECT * FROM pgstatindex('pg_cast_oid_index');
-[ RECORD 1 ]------+------
version            | 2
tree_level         | 0
index_size         | 8192
root_block_no      | 1
internal_pages     | 0
leaf_pages         | 1
empty_pages        | 0
deleted_pages      | 0
avg_leaf_density   | 50.27
leaf_fragmentation | 0</PRE><P>
</P><P>
输出字段是：
<DIV CLASS="INFORMALTABLE"><P></P><A NAME="AEN149270"></A><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><THEAD><TR><TH>字段</TH><TH>类型</TH><TH>描述</TH></TR></THEAD><TBODY><TR><TD><TT CLASS="STRUCTFIELD">version</TT></TD><TD><TT CLASS="TYPE">integer</TT></TD><TD>B-tree 版本号</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">tree_level</TT></TD><TD><TT CLASS="TYPE">integer</TT></TD><TD>根页面的树级别</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">index_size</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>索引中页面的总数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">root_block_no</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>根块的位置</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">internal_pages</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD><SPAN CLASS="QUOTE">"internal"</SPAN> (上一级) 页面的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">leaf_pages</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>叶子页面的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">empty_pages</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>空白页面的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">deleted_pages</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>已删除页面的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">avg_leaf_density</TT></TD><TD><TT CLASS="TYPE">float8</TT></TD><TD>叶子页面的平均密度</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">leaf_fragmentation</TT></TD><TD><TT CLASS="TYPE">float8</TT></TD><TD>叶子页面碎片</TD></TR></TBODY></TABLE><P></P></DIV>
</P><P>与<CODE CLASS="FUNCTION">pgstattuple</CODE>一样，结果是一页一页的累积的，
不应该期望代表整个索引的一个瞬间快照。</P></DD><DT>&#13; <CODE CLASS="FUNCTION">pgstatginindex(regclass) returns record</CODE></DT><DD><P>
<CODE CLASS="FUNCTION">pgstatginindex</CODE>返回一个显示关于GIN索引信息的记录。例如：
</P><PRE CLASS="PROGRAMLISTING">test=&#62; SELECT * FROM pgstatginindex('test_gin_index');
-[ RECORD 1 ]--+--
version        | 1
pending_pages  | 0
pending_tuples | 0</PRE><P>
</P><P>
输出字段是：
<DIV CLASS="INFORMALTABLE"><P></P><A NAME="AEN149351"></A><TABLE BORDER="1" CLASS="CALSTABLE"><COL><COL><COL><THEAD><TR><TH>字段</TH><TH>类型</TH><TH>描述</TH></TR></THEAD><TBODY><TR><TD><TT CLASS="STRUCTFIELD">version</TT></TD><TD><TT CLASS="TYPE">integer</TT></TD><TD>GIN 版本号</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">pending_pages</TT></TD><TD><TT CLASS="TYPE">integer</TT></TD><TD>等待列表中页面的数量</TD></TR><TR><TD><TT CLASS="STRUCTFIELD">pending_tuples</TT></TD><TD><TT CLASS="TYPE">bigint</TT></TD><TD>等待列表中元组的数量</TD></TR></TBODY></TABLE><P></P></DIV>
</P></DD><DT>&#13; <CODE CLASS="FUNCTION">pg_relpages(text) returns bigint</CODE></DT><DD><P><CODE CLASS="FUNCTION">pg_relpages</CODE>返回关系中页面的数量。</P></DD></DL></DIV></DIV><DIV CLASS="SECT2"><H2 CLASS="SECT2"><A NAME="AEN149385">F.29.2. 作者</A></H2><P>Tatsuo Ishii 和 Satoshi Nagayasu</P></DIV></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="pgstatstatements.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="pgtrgm.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top">pg_stat_statements</TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/contrib.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">pg_trgm</TD></TR></TABLE></DIV></BODY></HTML>
