<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD><TITLE>vacuumdb</TITLE><META NAME="GENERATOR" CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK REV="MADE" HREF="mailto:pgsql-docs@postgresql.org"><LINK REL="HOME" TITLE="PostgreSQL 9.3.1 中文手册" HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html"><LINK REL="UP" TITLE="PostgreSQL 客户端应用程序" HREF="http://school.yunwei.edu/manual/PostgreSQL/reference-client.html"><LINK REL="PREVIOUS" TITLE="reindexdb" HREF="app-reindexdb.html"><LINK REL="NEXT" TITLE="PostgreSQL 服务器应用程序" HREF="http://school.yunwei.edu/manual/PostgreSQL/reference-server.html"><LINK REL="STYLESHEET" TYPE="text/css" HREF="http://school.yunwei.edu/manual/PostgreSQL/stylesheet.css"><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8"><META NAME="creation" CONTENT="2015-07-11T14:00:17"></HEAD><BODY CLASS="REFENTRY">
<div style="text-align:right">
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/issues/new" target="_blank" title="在Github上报告问题（请注明问题内容及所在章节）">问题报告</a>
<a style="margin : 0px 0px 0px 10px;" href="https://github.com/postgres-cn/pgdoc-cn/edit/master/postgresql/doc/src/sgml/ref/vacuumdb.sgml" target="_blank" title="直接在Github上纠错本页面">纠错本页面</a>
</div>
<DIV CLASS="NAVHEADER"><TABLE SUMMARY="Header navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TH COLSPAN="5" ALIGN="center" VALIGN="bottom"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html">PostgreSQL 9.3.1 中文手册</A></TH></TR><TR><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A TITLE="reindexdb" HREF="app-reindexdb.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="10%" ALIGN="left" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/reference-client.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="60%" ALIGN="center" VALIGN="bottom"></TD><TD WIDTH="20%" ALIGN="right" VALIGN="top"><A TITLE="PostgreSQL 服务器应用程序" HREF="http://school.yunwei.edu/manual/PostgreSQL/reference-server.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR></TABLE><HR ALIGN="LEFT" WIDTH="100%"></DIV><H1><A NAME="APP-VACUUMDB"></A><SPAN CLASS="APPLICATION">vacuumdb</SPAN></H1><DIV CLASS="REFNAMEDIV"><A NAME="AEN88749"></A><H2>&#21517;&#31216;</H2>vacuumdb&nbsp;--&nbsp; 收集垃圾并分析一个<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>数据库</DIV><DIV CLASS="REFSYNOPSISDIV"><A NAME="AEN88755"></A><H2>&#22823;&#32434;</H2><P><TT CLASS="COMMAND">vacuumdb</TT> [<TT CLASS="REPLACEABLE"><I>connection-option</I></TT>...] [<TT CLASS="REPLACEABLE"><I>option</I></TT>...] [ <TT CLASS="OPTION">--table</TT> | <TT CLASS="OPTION">-t</TT>
<TT CLASS="REPLACEABLE"><I>table</I></TT>
[( <TT CLASS="REPLACEABLE"><I>column</I></TT> [,...] )]
]
... [<TT CLASS="REPLACEABLE"><I>dbname</I></TT>]</P><P><TT CLASS="COMMAND">vacuumdb</TT> [<TT CLASS="REPLACEABLE"><I>connection-option</I></TT>...] [<TT CLASS="REPLACEABLE"><I>option</I></TT>...] <TT CLASS="OPTION">--all</TT> | <TT CLASS="OPTION">-a</TT> </P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN88785"></A><H2>描述</H2><P><SPAN CLASS="APPLICATION">vacuumdb</SPAN>是一个用于整理<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
数据库的工具。<SPAN CLASS="APPLICATION">vacuumdb</SPAN>还将会生成用于
<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>查询优化器的内部统计数据。</P><P><SPAN CLASS="APPLICATION">vacuumdb</SPAN>是 SQL 命令<A HREF="sql-vacuum.html">VACUUM</A>的封装。
因此，用哪种方法清理数据库都一样。</P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN88795"></A><H2>选项</H2><P> <SPAN CLASS="APPLICATION">vacuumdb</SPAN>接受下列命令行参数：
<P></P></P><DIV CLASS="VARIABLELIST"><DL><DT><TT CLASS="OPTION">-a</TT><BR><TT CLASS="OPTION">--all</TT></DT><DD><P>清理所有数据库。</P></DD><DT><TT CLASS="OPTION">[<SPAN CLASS="OPTIONAL">-d</SPAN>] <TT CLASS="REPLACEABLE"><I>dbname</I></TT></TT><BR><TT CLASS="OPTION">[<SPAN CLASS="OPTIONAL">--dbname=</SPAN>]<TT CLASS="REPLACEABLE"><I>dbname</I></TT></TT></DT><DD><P>声明要被清理或分析的数据库名称。如果没有声明这个参数并且没有使用<TT CLASS="OPTION">-a</TT>
或<TT CLASS="OPTION">--all</TT>，那么从将环境变量<TT CLASS="ENVAR">PGDATABASE</TT>里读取数据库名。
如果那个也没有设置，则使用连接的用户名。</P></DD><DT><TT CLASS="OPTION">-e</TT><BR><TT CLASS="OPTION">--echo</TT></DT><DD><P>回显<SPAN CLASS="APPLICATION">vacuumdb</SPAN>生成并发送给服务器的命令。</P></DD><DT><TT CLASS="OPTION">-f</TT><BR><TT CLASS="OPTION">--full</TT></DT><DD><P>执行<SPAN CLASS="QUOTE">"完全"</SPAN>清理。</P></DD><DT><TT CLASS="OPTION">-F</TT><BR><TT CLASS="OPTION">--freeze</TT></DT><DD><P>强制<SPAN CLASS="QUOTE">"冻结"</SPAN>元组。</P></DD><DT><TT CLASS="OPTION">-q</TT><BR><TT CLASS="OPTION">--quiet</TT></DT><DD><P>不显示进程信息。</P></DD><DT><TT CLASS="OPTION">-t <TT CLASS="REPLACEABLE"><I>table</I></TT> [ (<TT CLASS="REPLACEABLE"><I>column</I></TT> [,...]) ]</TT><BR><TT CLASS="OPTION">--table=<TT CLASS="REPLACEABLE"><I>table</I></TT> [ (<TT CLASS="REPLACEABLE"><I>column</I></TT> [,...]) ]</TT></DT><DD><P>只是清理或分析<TT CLASS="REPLACEABLE"><I>table</I></TT>。
字段名称只是在与<TT CLASS="OPTION">--analyze</TT>或<TT CLASS="OPTION">--analyze-only</TT>
选项联合使用时才需要声明。可以通过写多个<TT CLASS="OPTION">-t</TT>选项清理多个表。</P><DIV CLASS="TIP"><BLOCKQUOTE CLASS="TIP"><P><B>&#25552;&#31034;: </B>如果你声明了要清理的字段，你可能不得不在 shell 上转义圆括弧(见下面的例子)。</P></BLOCKQUOTE></DIV></DD><DT><TT CLASS="OPTION">-v</TT><BR><TT CLASS="OPTION">--verbose</TT></DT><DD><P>在处理过程中打印详细信息。</P></DD><DT><TT CLASS="OPTION">-V</TT><BR><TT CLASS="OPTION">--version</TT></DT><DD><P>打印<SPAN CLASS="APPLICATION">vacuumdb</SPAN>版本然后退出。</P></DD><DT><TT CLASS="OPTION">-z</TT><BR><TT CLASS="OPTION">--analyze</TT></DT><DD><P>计算用于优化器的统计数据。</P></DD><DT><TT CLASS="OPTION">-Z</TT><BR><TT CLASS="OPTION">--analyze-only</TT></DT><DD><P>只计算用于优化器的该数据库的统计值（不清理）。</P></DD><DT><TT CLASS="OPTION">-?</TT><BR><TT CLASS="OPTION">--help</TT></DT><DD><P>显示关于<SPAN CLASS="APPLICATION">vacuumdb</SPAN>命令行参数的帮助然后退出。</P></DD></DL></DIV><P>
</P><P><SPAN CLASS="APPLICATION">vacuumdb</SPAN>还接受下列命令行参数作为连接参数：
<P></P></P><DIV CLASS="VARIABLELIST"><DL><DT><TT CLASS="OPTION">-h <TT CLASS="REPLACEABLE"><I>host</I></TT></TT><BR><TT CLASS="OPTION">--host=<TT CLASS="REPLACEABLE"><I>host</I></TT></TT></DT><DD><P>
指定运行服务器的主机名。如果数值以斜杠开头，则被用作到 Unix 域套接字的路径。
</P></DD><DT><TT CLASS="OPTION">-p <TT CLASS="REPLACEABLE"><I>port</I></TT></TT><BR><TT CLASS="OPTION">--port=<TT CLASS="REPLACEABLE"><I>port</I></TT></TT></DT><DD><P>指定服务器正在侦听的 TCP 端口或本地 Unix 域套接字文件的扩展(描述符)。</P></DD><DT><TT CLASS="OPTION">-U <TT CLASS="REPLACEABLE"><I>username</I></TT></TT><BR><TT CLASS="OPTION">--username=<TT CLASS="REPLACEABLE"><I>username</I></TT></TT></DT><DD><P>连接的用户名。</P></DD><DT><TT CLASS="OPTION">-w</TT><BR><TT CLASS="OPTION">--no-password</TT></DT><DD><P>从不发出密码提示问题。如果服务器要求密码认证并且密码不可用于其他意思如
<TT CLASS="FILENAME">.pgpass</TT>文件，则连接尝试将会失败。
该选项在批量工作和不存在用户输入密码的脚本中很有帮助。</P></DD><DT><TT CLASS="OPTION">-W</TT><BR><TT CLASS="OPTION">--password</TT></DT><DD><P>强制<SPAN CLASS="APPLICATION">vacuumdb</SPAN>在连接到数据库之前提示一个密码。</P><P>这个选项从来不是至关重要的，因为如果服务器需求密码认证，则<SPAN CLASS="APPLICATION">vacuumdb</SPAN>
自动提示一个密码。不过，<SPAN CLASS="APPLICATION">vacuumdb</SPAN>
将在找出服务器想要一个密码上浪费一个连接尝试。在某些情况下，值得输入<TT CLASS="OPTION">-W</TT>
以避免额外的连接尝试。</P></DD><DT><TT CLASS="OPTION">--maintenance-db=<TT CLASS="REPLACEABLE"><I>dbname</I></TT></TT></DT><DD><P>指定要连接到的数据库的名字以发现其他应该清理的数据库。如果没有指定，
那么将使用<TT CLASS="LITERAL">postgres</TT>数据库，如果该数据库不存在，
则使用<TT CLASS="LITERAL">template1</TT>。</P></DD></DL></DIV><P>
</P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN88964"></A><H2>环境变量</H2><P></P><DIV CLASS="VARIABLELIST"><DL><DT><TT CLASS="ENVAR">PGDATABASE</TT><BR><TT CLASS="ENVAR">PGHOST</TT><BR><TT CLASS="ENVAR">PGPORT</TT><BR><TT CLASS="ENVAR">PGUSER</TT></DT><DD><P>缺省连接参数</P></DD></DL></DIV><P>这个工具，类似大多数其他<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>实用工具，
也使用由<SPAN CLASS="APPLICATION">libpq</SPAN>支持的环境变量（参阅<A HREF="libpq-envars.html">第 31.14 &#33410;</A>）。</P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN88982"></A><H2>诊断</H2><P>如果出差错了。参阅<A HREF="sql-vacuum.html">VACUUM</A>和<A HREF="app-psql.html"><SPAN CLASS="APPLICATION">psql</SPAN></A>
获取关于错误信息和可能问题的详细描述。数据库服务器必须在目标主机上运行。
同样，任何<SPAN CLASS="APPLICATION">libpq</SPAN>前端库可获得的缺省设置和环境变量都将生效。</P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN88988"></A><H2>注意</H2><P><SPAN CLASS="APPLICATION">vacuumdb</SPAN>可能需要与<SPAN CLASS="PRODUCTNAME">PostgreSQL</SPAN>
服务器连接若干次，每次都询问口令。在这种情况下，设立一个<TT CLASS="FILENAME">~/.pgpass</TT>
文件是比较方便的。参阅<A HREF="libpq-pgpass.html">第 31.15 &#33410;</A>获取更多信息。</P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN88995"></A><H2>例子</H2><P>整理数据库<TT CLASS="LITERAL">test</TT>：
</P><PRE CLASS="SCREEN"><SAMP
CLASS="PROMPT"
>$ </SAMP
><KBD
CLASS="USERINPUT"
>vacuumdb test</KBD
></PRE><P></P><P>为优化器清理和分析一个名为<TT CLASS="LITERAL">bigdb</TT>的数据库：
</P><PRE CLASS="SCREEN"><SAMP
CLASS="PROMPT"
>$ </SAMP
><KBD
CLASS="USERINPUT"
>vacuumdb --analyze bigdb</KBD
></PRE><P></P><P>清理数据库<TT CLASS="LITERAL">xyzzy</TT>中名为<TT CLASS="LITERAL">foo</TT>的表，
并且为优化器分析列<TT CLASS="LITERAL">bar</TT>：
</P><PRE CLASS="SCREEN"><SAMP
CLASS="PROMPT"
>$ </SAMP
><KBD
CLASS="USERINPUT"
>vacuumdb --analyze --verbose --table 'foo(bar)' xyzzy</KBD
></PRE><P></P></DIV><DIV CLASS="REFSECT1"><A NAME="AEN89014"></A><H2>又见</H2><A HREF="sql-vacuum.html">VACUUM</A></DIV><DIV CLASS="NAVFOOTER"><HR ALIGN="LEFT" WIDTH="100%"><TABLE SUMMARY="Footer navigation table" WIDTH="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0"><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><A HREF="app-reindexdb.html" ACCESSKEY="P">&#19978;&#19968;&#39029;</A></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/index.html" ACCESSKEY="H">&#36215;&#22987;&#39029;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/reference-server.html" ACCESSKEY="N">&#19979;&#19968;&#39029;</A></TD></TR><TR><TD WIDTH="33%" ALIGN="left" VALIGN="top"><SPAN CLASS="APPLICATION">reindexdb</SPAN></TD><TD WIDTH="34%" ALIGN="center" VALIGN="top"><A HREF="http://school.yunwei.edu/manual/PostgreSQL/reference-client.html" ACCESSKEY="U">&#19978;&#19968;&#32423;</A></TD><TD WIDTH="33%" ALIGN="right" VALIGN="top">PostgreSQL 服务器应用程序</TD></TR></TABLE></DIV></BODY></HTML>
